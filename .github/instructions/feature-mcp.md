# MCP Artifact Creation — Format Reference

This file documents what `WorkItemOrchestrator` creates via MCP, the expected structure
of each artifact, and the cross-linking rules between them.

Use this as the authoritative reference when:
- Modifying how Jira ticket content is generated
- Changing wiki page structure or header format
- Adding new artifact types to the orchestration pipeline
- Debugging why created content looks wrong

---

## Overview

When `enableActiveCreation = true`, the orchestrator runs in order:

| Step | What | Via |
|------|------|-----|
| A | Jira ticket + image attach | `jira_create_issue`, `jira_update_issue` |
| B | Implementation Plan wiki + image attach | `confluence_create_page`, REST |
| E | QA Test Case wiki + image attach + back-patch Impl wiki | `confluence_create_page`, `confluence_update_page` |
| C | Jira remote links (×2) + Related Resources block | `jira_create_remote_issue_link`, `jira_update_issue` |
| D | Git branch (conditional on `GIT_MCP_URL`) | Git MCP |

---

## ARTIFACT 1: Jira Ticket

### Title format
```
Implementation Plan: <componentName> — <pageName>
```
(If `pageName` === `componentName`, the `— <pageName>` suffix is omitted.)

### Description body (Jira wiki markup)
AI-generated by `GeminiService`. Step C injects this block **near the top** after the
first heading, then strips any AI-generated `h2. Design References` section:

```
h2. Related Resources

* [View in Figma|<figmaDeepLink>]
* [Implementation Plan|<wikiPageUrl>]
* Storybook: TBD
* [QA Test Case|<qaPageUrl>]
```

### Image attachment
Attached via direct Confluence REST (primary) with MCP fallback. The image is the
Figma frame exported via `fetchFigmaExportUrl()` → CDN URL → downloaded to temp file.

---

## ARTIFACT 2: Implementation Plan Wiki

### Title format
```
Implementation Plan: <componentName> — <pageName>
```

### Page structure

```markdown
**Component:** <componentName>  
**Figma:** [View in Figma](<figmaDeepLink>)  
**Jira:** [<issueKey>](<jiraWebUrl>)  
**Date:** <YYYY-MM-DD>  
**Storybook:** TBD  
**QA Test Case:** TBD  ← back-patched with real link after Step E

---

<AI-generated implementation spec in markdown>

<!-- design-preview -->
![Design Preview](<imageAttachmentUrl>)
```

### Back-patch (Step E)
After the QA page is created, the orchestrator calls `confluence_update_page` to
replace the `**QA Test Case:** TBD` line with a real link. The sentinel
`<!-- design-preview -->` marker ensures image position is preserved.

---

## ARTIFACT 3: QA Test Case Wiki

### Title format
```
<pageName> - <issueKey> - <componentName>
```

### Page structure

```markdown
**Component:** <componentName>  
**Jira Ticket:** [<issueKey>](<jiraWebUrl>)  
**Implementation Plan:** [View Wiki](<wikiPageUrl>)  
**Storybook:** TBD  
**Date:** <YYYY-MM-DD>

---

## Test Scenarios

| # | Scenario | Steps | Expected Result | Status |
|---|----------|-------|-----------------|--------|
| 1 | Default render | Navigate to component | Component displays correctly | ☐ |
| 2 | Responsive — mobile | Resize to 375px | Layout adjusts per spec | ☐ |
| 3 | Responsive — tablet | Resize to 768px | Layout adjusts per spec | ☐ |
| 4 | Responsive — desktop | Resize to 1280px+ | Layout adjusts per spec | ☐ |
| 5 | Accessibility | Run axe-core | Zero critical violations | ☐ |
| 6 | Keyboard navigation | Tab through elements | All interactive elements reachable | ☐ |
| 7 | Content variants | Test with short/long content | No overflow, no layout break | ☐ |
| 8 | Cross-browser | Chrome, Firefox, Safari | Consistent visual output | ☐ |

<!-- design-preview -->
![Design Preview](<imageAttachmentUrl>)
```

---

## Jira Remote Links

Step C creates exactly **2** remote links in Jira's Links panel:

| Title | URL | Relationship |
|-------|-----|--------------|
| `Implementation Plan` | Confluence wiki URL | `Wiki Page` |
| `QA Test Case` | QA wiki URL | `QA Documentation` |

Storybook is **not** created as a remote link — it appears as `TBD` text until a real
URL is available. Never create `about:blank` or placeholder remote links.

---

## Git Branch (Optional)

Only runs when `GIT_MCP_URL` is set in `.env`. When blank, Step D is silently skipped.

```
Branch name: feature/<kebab-case-component-name>
Base: main
```

---

## Orchestration Response Shape

```json
{
  "content": "<AI-generated markdown>",
  "metadata": {
    "orchestration": {
      "jira":  { "url": "https://jira.corp.com/browse/PROJ-123", "issueKey": "PROJ-123", "status": "created" },
      "wiki":  { "url": "https://confluence.corp.com/...", "status": "created" },
      "qa":    { "url": "https://confluence.corp.com/...", "status": "created" },
      "git":   { "branch": "feature/my-component", "status": "created" }
    }
  }
}
```

The plugin UI reads `orchestration.jira.url`, `orchestration.wiki.url`, and
`orchestration.qa.url` to populate the three creation link buttons.

---

## Execution Rules

- All step failures are **non-fatal**: later steps continue; failed steps surface in UI
- Image reuse: one `sharedAttachment` temp file is shared across Steps A, B, E
- The `finally` block cleans up the temp file after all steps complete
- Never add `content_format` or `version` params to Confluence MCP calls
- Never add `about:blank` or placeholder remote links — real URL or nothing
