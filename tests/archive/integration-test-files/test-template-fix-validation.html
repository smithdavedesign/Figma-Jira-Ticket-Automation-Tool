<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Template Fix Validation Test</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            max-width: 1400px;
            margin: 20px auto;
            padding: 20px;
            line-height: 1.6;
        }
        .test-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin: 20px 0;
        }
        .test-section {
            padding: 20px;
            border: 1px solid #e1e5e9;
            border-radius: 8px;
            background: #f8f9fa;
        }
        .success {
            border-color: #28a745;
            background: #d4edda;
        }
        .error {
            border-color: #dc3545;
            background: #f8d7da;
        }
        .warning {
            border-color: #ffc107;
            background: #fff3cd;
        }
        .test-controls {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 15px;
            margin: 15px 0;
        }
        select, input, button {
            padding: 8px;
            border: 1px solid #ccc;
            border-radius: 4px;
        }
        button {
            background: #007bff;
            color: white;
            border: none;
            cursor: pointer;
        }
        button:hover {
            background: #0056b3;
        }
        .results {
            background: #1a1a1a;
            color: #00ff00;
            padding: 15px;
            border-radius: 4px;
            font-family: 'Monaco', 'Consolas', monospace;
            font-size: 12px;
            overflow-x: auto;
            margin: 10px 0;
            max-height: 500px;
            overflow-y: auto;
        }
        .comparison {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
            margin: 15px 0;
        }
        .before, .after {
            padding: 15px;
            border-radius: 4px;
            font-family: monospace;
            font-size: 11px;
        }
        .before {
            background: #f8d7da;
            border: 1px solid #dc3545;
        }
        .after {
            background: #d4edda;
            border: 1px solid #28a745;
        }
    </style>
</head>
<body>
    <h1>ğŸ”§ Template Selection Fix Validation</h1>
    
    <div class="test-section success">
        <h2>âœ… Fix Applied</h2>
        <p>The template selection logic has been updated to:</p>
        <ul>
            <li><strong>Remove hardcoded fallbacks</strong> for React/TypeScript</li>
            <li><strong>Add dynamic tech stack detection</strong> for AEM, React, Vue, Angular</li>
            <li><strong>Generate appropriate team standards</strong> based on actual selections</li>
            <li><strong>Respect document type selections</strong> (wiki, component, etc.)</li>
        </ul>
    </div>

    <div class="test-grid">
        <div class="test-section">
            <h3>ğŸ§ª Test Template Generation</h3>
            <div class="test-controls">
                <div>
                    <label>Tech Stack:</label>
                    <select id="testTechStack">
                        <option value="">-- Select --</option>
                        <option value="AEM 6.5 with HTL (HTML Template Language), Apache Sling framework, OSGi bundles, JCR repository, Touch UI components">AEM 6.5</option>
                        <option value="React 18 with TypeScript, Vite build system, Tailwind CSS">React + TypeScript</option>
                        <option value="Vue 3 with Composition API, TypeScript, Vite, Pinia">Vue 3</option>
                        <option value="Angular 17 with TypeScript, Angular CLI, RxJS">Angular 17</option>
                    </select>
                </div>
                <div>
                    <label>Document Type:</label>
                    <select id="testDocType">
                        <option value="">-- Select --</option>
                        <option value="wiki">ğŸ“š Wiki Guide</option>
                        <option value="component">ğŸ§© Component</option>
                        <option value="jira">ğŸ« JIRA Ticket</option>
                    </select>
                </div>
                <div>
                    <label>Platform:</label>
                    <select id="testPlatform">
                        <option value="jira">JIRA</option>
                        <option value="confluence">Confluence</option>
                        <option value="github">GitHub</option>
                    </select>
                </div>
            </div>
            <button onclick="testTemplateGeneration()">ğŸ§ª Test Template Logic</button>
            <button onclick="testMCPCall()">ğŸ”Œ Test MCP Call</button>
            <div id="testResults" class="results"></div>
        </div>

        <div class="test-section">
            <h3>ğŸ“Š Before vs After Comparison</h3>
            <div class="comparison">
                <div class="before">
                    <h4>âŒ Before (Hardcoded)</h4>
                    <pre>
// Hardcoded fallbacks
platform: platformSelect.value || 'jira',
documentType: documentType || 'component',
teamStandards: {
  tech_stack: techStackDesc ? 
    techStackDesc.split(',') : 
    ['React', 'TypeScript'], // âŒ Always React
  testing_framework: 'jest-rtl', // âŒ Always React testing
  accessibility_level: 'wcag-aa',
  documentation_format: 'markdown',
  code_style: 'prettier'
}
                    </pre>
                </div>
                <div class="after">
                    <h4>âœ… After (Dynamic)</h4>
                    <pre>
// Dynamic generation
platform: platformSelect.value,
documentType: documentType,
teamStandards: generateDynamicTeamStandards(
  techStackDesc, 
  documentType
)

// AEM Example Output:
{
  tech_stack: ['AEM 6.5', 'HTL', 'Sling Models', 'OSGi'],
  testing_framework: 'aem-mocks',
  build_tool: 'Maven',
  deployment: 'AEM Package Manager'
}
                    </pre>
                </div>
            </div>
        </div>
    </div>

    <div class="test-section">
        <h3>ğŸ¯ Expected Template Outputs</h3>
        <div id="expectedOutputs"></div>
        <button onclick="showExpectedOutputs()">ğŸ“‹ Show Expected Results</button>
    </div>

    <div class="test-section warning">
        <h3>âš ï¸ Testing Instructions</h3>
        <ol>
            <li><strong>Use the fixed UI:</strong> Open <a href="http://localhost:8080/test/figma-plugin-simulator.html" target="_blank">Fixed Plugin Simulator</a></li>
            <li><strong>Select AEM + Wiki:</strong> Choose "AEM 6.5" tech stack and "Wiki" document type</li>
            <li><strong>Generate ticket:</strong> Use the AI generation feature</li>
            <li><strong>Verify output:</strong> Should now show AEM-specific content with HTL, Sling Models, etc.</li>
            <li><strong>Test other combinations:</strong> Try React + Component, Vue + Component</li>
        </ol>
    </div>

    <script>
        // Import the fixed dynamic team standards function (copied from main UI)
        function generateDynamicTeamStandards(techStackDesc, documentType) {
            const standards = {
                tech_stack: ['Generic'],
                testing_framework: 'generic',
                accessibility_level: 'wcag-aa',
                documentation_format: 'markdown',
                code_style: 'prettier'
            };

            if (!techStackDesc) {
                return standards;
            }

            const techLower = techStackDesc.toLowerCase();

            // AEM Tech Stack Detection
            if (techLower.includes('aem') || techLower.includes('adobe experience manager') || 
                techLower.includes('htl') || techLower.includes('html template language') ||
                techLower.includes('sling') || techLower.includes('osgi') || 
                techLower.includes('touch ui') || techLower.includes('jcr')) {
                
                standards.tech_stack = ['AEM 6.5', 'HTL', 'Sling Models', 'OSGi', 'Touch UI', 'JCR'];
                standards.testing_framework = 'aem-mocks';
                standards.build_tool = 'Maven';
                standards.deployment = 'AEM Package Manager';
                standards.component_structure = 'Touch UI Components';
                standards.data_binding = 'Sling Models';
                
                if (documentType === 'wiki') {
                    standards.template_focus = 'implementation-guide';
                    standards.content_sections = ['HTL Implementation', 'Sling Model', 'Touch UI Dialog', 'Testing Strategy', 'Deployment'];
                }
            }
            // React Tech Stack Detection  
            else if (techLower.includes('react')) {
                standards.tech_stack = ['React', 'TypeScript', 'Vite'];
                standards.testing_framework = 'jest-rtl';
                standards.build_tool = techLower.includes('vite') ? 'Vite' : 'Create React App';
                standards.state_management = techLower.includes('redux') ? 'Redux' : 'React State';
                
                if (techLower.includes('next')) {
                    standards.tech_stack.push('Next.js');
                    standards.build_tool = 'Next.js';
                }
            }
            // Vue Tech Stack Detection
            else if (techLower.includes('vue')) {
                standards.tech_stack = ['Vue 3', 'TypeScript', 'Vite'];
                standards.testing_framework = 'vitest';
                standards.build_tool = 'Vite';
                standards.composition_api = true;
                
                if (techLower.includes('pinia')) {
                    standards.state_management = 'Pinia';
                }
            }
            // Angular Tech Stack Detection
            else if (techLower.includes('angular')) {
                standards.tech_stack = ['Angular', 'TypeScript', 'Angular CLI'];
                standards.testing_framework = 'jasmine-karma';
                standards.build_tool = 'Angular CLI';
                standards.dependency_injection = true;
            }

            // Document type specific adjustments
            if (documentType === 'wiki') {
                standards.documentation_style = 'comprehensive-guide';
                standards.include_code_examples = true;
                standards.include_architecture_diagrams = true;
            } else if (documentType === 'component') {
                standards.documentation_style = 'technical-specification';
                standards.include_props_api = true;
                standards.include_usage_examples = true;
            }

            return standards;
        }

        function testTemplateGeneration() {
            const techStack = document.getElementById('testTechStack').value;
            const docType = document.getElementById('testDocType').value;
            const platform = document.getElementById('testPlatform').value;

            const results = document.getElementById('testResults');
            
            if (!techStack || !docType) {
                results.innerHTML = `<span style="color: #ff6666;">âŒ Please select both Tech Stack and Document Type</span>`;
                return;
            }

            const oldStandards = {
                tech_stack: techStack ? techStack.split(',').map(s => s.trim()) : ['React', 'TypeScript'],
                testing_framework: 'jest-rtl',
                accessibility_level: 'wcag-aa',
                documentation_format: 'markdown',
                code_style: 'prettier'
            };

            const newStandards = generateDynamicTeamStandards(techStack, docType);

            const isFixed = JSON.stringify(oldStandards) !== JSON.stringify(newStandards);

            results.innerHTML = `
<span style="color: #00ffff;">ğŸ§ª TEMPLATE GENERATION TEST</span>
<span style="color: #ffff00;">â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•</span>

<span style="color: #00ffff;">ğŸ“‹ INPUTS:</span>
â”œâ”€â”€ Tech Stack: ${techStack}
â”œâ”€â”€ Document Type: ${docType}
â””â”€â”€ Platform: ${platform}

<span style="color: #ff6666;">âŒ OLD (HARDCODED) STANDARDS:</span>
<pre style="color: #ff6666; margin-left: 10px;">${JSON.stringify(oldStandards, null, 2)}</pre>

<span style="color: #66ff66;">âœ… NEW (DYNAMIC) STANDARDS:</span>
<pre style="color: #66ff66; margin-left: 10px;">${JSON.stringify(newStandards, null, 2)}</pre>

<span style="color: #00ffff;">ğŸ” ANALYSIS:</span>
â”œâ”€â”€ Standards Changed: <span style="color: ${isFixed ? '#66ff66' : '#ff6666'}">${isFixed ? 'âœ… YES' : 'âŒ NO'}</span>
â”œâ”€â”€ Framework Detection: <span style="color: #66ff66;">${
    newStandards.testing_framework !== 'jest-rtl' ? 'âœ… WORKING' : 
    techStack.includes('AEM') ? 'âŒ FAILED' : 'âœ… CORRECT'
}</span>
â”œâ”€â”€ Build Tool: <span style="color: #66ff66;">${newStandards.build_tool || 'Not specified'}</span>
â””â”€â”€ Template Focus: <span style="color: #66ff66;">${newStandards.template_focus || 'Standard'}</span>

<span style="color: #00ffff;">ğŸ“Š EXPECTED TICKET CHANGES:</span>
${techStack.includes('AEM') && docType === 'wiki' ? 
    '<span style="color: #66ff66;">âœ… Should generate AEM implementation guide with HTL, Sling Models, Touch UI dialogs</span>' :
    techStack.includes('React') && docType === 'component' ?
    '<span style="color: #66ff66;">âœ… Should generate React component spec with TypeScript, Jest tests</span>' :
    '<span style="color: #ffff00;">âš ï¸ Will use detected framework-specific template</span>'
}
            `;
        }

        function testMCPCall() {
            const techStack = document.getElementById('testTechStack').value;
            const docType = document.getElementById('testDocType').value;
            const platform = document.getElementById('testPlatform').value;

            if (!techStack || !docType) {
                document.getElementById('testResults').innerHTML = `<span style="color: #ff6666;">âŒ Please select inputs first</span>`;
                return;
            }

            const templateParams = {
                frameData: [{
                    id: "test-component",
                    name: "Why Solidigm?",
                    type: "INSTANCE"
                }],
                figmaContext: {
                    figmaUrl: "https://www.figma.com/file/test",
                    component_name: "Why Solidigm?",
                    frame_id: "test-id"
                },
                platform: platform,
                documentType: docType,
                projectName: "Test Project",
                screenshot: "https://example.com/screenshot.png",
                teamStandards: generateDynamicTeamStandards(techStack, docType)
            };

            document.getElementById('testResults').innerHTML = `
<span style="color: #00ffff;">ğŸ”Œ MCP CALL SIMULATION</span>
<span style="color: #ffff00;">â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•</span>

<span style="color: #00ffff;">ğŸ“¤ WOULD SEND TO MCP SERVER:</span>
<pre style="color: #ffffff; margin-left: 10px;">${JSON.stringify(templateParams, null, 2)}</pre>

<span style="color: #00ffff;">ğŸ¯ EXPECTED RESPONSE:</span>
${generateMockResponse(templateParams)}

<span style="color: #66ff66;">âœ… Ready to test with real MCP server at:</span>
<span style="color: #66ff66;">   http://localhost:8080/test/figma-plugin-simulator.html</span>
            `;
        }

        function generateMockResponse(params) {
            const isAEM = params.teamStandards.tech_stack.includes('AEM 6.5');
            const isWiki = params.documentType === 'wiki';

            if (isAEM && isWiki) {
                return `
<span style="color: #66ff66;">ğŸ“š AEM Component Implementation Guide</span>

<span style="color: #ffffff;">## ğŸ—ï¸ HTL Template Implementation</span>
<span style="color: #ffffff;">- Sling Model: WhySolidgmModel.java</span>
<span style="color: #ffffff;">- HTL Template: why-solidgm.html</span>
<span style="color: #ffffff;">- Touch UI Dialog: _cq_dialog.xml</span>

<span style="color: #ffffff;">## ğŸ§ª Testing with AEM Mocks</span>
<span style="color: #ffffff;">- Maven Surefire plugin</span>
<span style="color: #ffffff;">- wcm.io testing framework</span>
<span style="color: #ffffff;">- AEM Rules validation</span>
                `;
            } else {
                return `<span style="color: #ffff00;">Standard template for ${params.teamStandards.tech_stack[0]} ${params.documentType}</span>`;
            }
        }

        function showExpectedOutputs() {
            document.getElementById('expectedOutputs').innerHTML = `
<div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin: 15px 0;">
    <div style="background: #d4edda; padding: 15px; border-radius: 4px;">
        <h4>âœ… AEM + Wiki (Fixed)</h4>
        <pre style="font-size: 11px;">
# ğŸ“š AEM Component Guide: Why Solidigm?

## ğŸ—ï¸ HTL Implementation
### Sling Model
@Model(adaptables = Resource.class)
public class WhySolidgmModel {
    @ValueMapValue private String title;
    // Component logic
}

## ğŸ›ï¸ Touch UI Dialog
- Title field (textfield)
- Description (textarea)  
- Image (pathfield)

## ğŸ§ª Testing Strategy
- AEM Mocks + JUnit 5
- wcm.io testing framework
- Maven Surefire plugin

## ğŸš€ Deployment
- Maven build
- AEM Package Manager
        </pre>
    </div>
    <div style="background: #f8d7da; padding: 15px; border-radius: 4px;">
        <h4>âŒ AEM + Wiki (Before Fix)</h4>
        <pre style="font-size: 11px;">
# ğŸ“š Guide: Why Solidigm?

## âœ… Acceptance Criteria
âœ… Visual Accuracy: Component matches design
ğŸ“± Responsive Design: Works across breakpoints
â™¿ Accessibility: Meets WCAG-AA standards
ğŸ§ª Testing: Unit tests with jest-rtl

## ğŸ§ª Testing Strategy
Framework: Jest + React Testing Library
Test Types: Unit tests, integration tests
Coverage: Component behavior, props validation

(Wrong framework - React instead of AEM!)
        </pre>
    </div>
</div>
            `;
        }

        // Auto-populate for demonstration
        window.addEventListener('load', () => {
            document.getElementById('testTechStack').value = 'AEM 6.5 with HTL (HTML Template Language), Apache Sling framework, OSGi bundles, JCR repository, Touch UI components';
            document.getElementById('testDocType').value = 'wiki';
            document.getElementById('testPlatform').value = 'jira';
            
            setTimeout(() => {
                testTemplateGeneration();
                showExpectedOutputs();
            }, 500);
        });
    </script>
</body>
</html>