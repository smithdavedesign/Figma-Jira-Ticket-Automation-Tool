<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Template Selection Debug Test</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            max-width: 1200px;
            margin: 40px auto;
            padding: 20px;
            line-height: 1.6;
        }
        .debug-section {
            margin: 20px 0;
            padding: 20px;
            border: 1px solid #e1e5e9;
            border-radius: 8px;
            background: #f8f9fa;
        }
        .problem-section {
            border-color: #dc3545;
            background: #f8d7da;
        }
        .solution-section {
            border-color: #28a745;
            background: #d4edda;
        }
        .test-controls {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 20px;
            margin: 20px 0;
        }
        .control-group {
            padding: 15px;
            border: 1px solid #ccc;
            border-radius: 6px;
            background: white;
        }
        select, input {
            width: 100%;
            padding: 8px;
            border: 1px solid #ccc;
            border-radius: 4px;
            margin-top: 5px;
        }
        button {
            background: #007bff;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 4px;
            cursor: pointer;
            margin: 5px;
        }
        button:hover {
            background: #0056b3;
        }
        .debug-output {
            background: #1a1a1a;
            color: #00ff00;
            padding: 15px;
            border-radius: 4px;
            font-family: 'Monaco', 'Consolas', monospace;
            font-size: 12px;
            overflow-x: auto;
            margin: 10px 0;
            max-height: 400px;
            overflow-y: auto;
        }
        .expected-vs-actual {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
        }
        .expected, .actual {
            padding: 15px;
            border-radius: 6px;
        }
        .expected {
            background: #d4edda;
            border: 1px solid #28a745;
        }
        .actual {
            background: #f8d7da;
            border: 1px solid #dc3545;
        }
        .issue-highlight {
            background-color: yellow;
            padding: 2px 4px;
            border-radius: 3px;
        }
    </style>
</head>
<body>
    <h1>ğŸ› Template Selection Debug Test</h1>
    
    <div class="debug-section problem-section">
        <h2>âŒ Current Problem</h2>
        <p>The system is not respecting user template selections:</p>
        <ul>
            <li><strong>User Selected</strong>: AEM tech stack + Wiki document type</li>
            <li><strong>System Generated</strong>: Generic React/Jest template with wrong content</li>
            <li><strong>Root Cause</strong>: Hardcoded template parameters in UI code</li>
        </ul>
        
        <div class="expected-vs-actual">
            <div class="expected">
                <h4>ğŸ¯ Expected (AEM Wiki)</h4>
                <pre>
# ğŸ“š AEM Component Guide: Why Solidigm?

## HTL Implementation
- Sling Model for data binding
- Touch UI component dialog
- OSGi service integration

## Development Guidelines  
- JCR node structure
- AEM 6.5 best practices
- Component testing with AEM mocks
                </pre>
            </div>
            <div class="actual">
                <h4>âŒ Current Output (Wrong Template)</h4>
                <pre>
# ğŸ“š Guide: Why Solidigm?

## âœ… Acceptance Criteria
- Visual Accuracy
- Responsive Design  
- Testing: Unit tests with jest-rtl

(Generic React template instead of AEM)
                </pre>
            </div>
        </div>
    </div>

    <div class="debug-section">
        <h2>ğŸ§ª Test Template Selection Logic</h2>
        
        <div class="test-controls">
            <div class="control-group">
                <label for="techStack"><strong>Tech Stack</strong></label>
                <select id="techStack">
                    <option value="">-- Select Tech Stack --</option>
                    <option value="AEM 6.5 with HTL (HTML Template Language), Apache Sling framework, OSGi bundles, JCR repository, Touch UI components">AEM 6.5</option>
                    <option value="React 18 with TypeScript, Vite build system, Tailwind CSS, React Router">React + TypeScript</option>
                    <option value="Vue 3 with Composition API, TypeScript, Vite, Vue Router, Pinia state management">Vue 3</option>
                    <option value="Angular 17 with TypeScript, Angular CLI, RxJS, Angular Material">Angular 17</option>
                    <option value="Next.js 14 with TypeScript, App Router, Tailwind CSS, Prisma ORM">Next.js 14</option>
                </select>
            </div>
            
            <div class="control-group">
                <label for="documentType"><strong>Document Type</strong></label>
                <select id="documentType">
                    <option value="">-- Select Document Type --</option>
                    <option value="wiki">ğŸ“š Wiki/Guide</option>
                    <option value="component">ğŸ§© Component Spec</option>
                    <option value="jira">ğŸ« JIRA Ticket</option>
                    <option value="confluence">ğŸ“„ Confluence Page</option>
                    <option value="github">ğŸ“‹ GitHub Issue</option>
                    <option value="spec">ğŸ“‹ Technical Spec</option>
                </select>
            </div>
            
            <div class="control-group">
                <label for="platform"><strong>Platform</strong></label>
                <select id="platform">
                    <option value="">-- Select Platform --</option>
                    <option value="jira">JIRA</option>
                    <option value="confluence">Confluence</option>
                    <option value="github">GitHub</option>
                    <option value="notion">Notion</option>
                    <option value="linear">Linear</option>
                </select>
            </div>
        </div>
        
        <button onclick="debugTemplateSelection()">ğŸ” Debug Template Selection</button>
        <button onclick="testMCPParameters()">ğŸ§ª Test MCP Parameters</button>
        <button onclick="compareTemplates()">ğŸ“Š Compare Templates</button>
        
        <div id="debugOutput" class="debug-output"></div>
    </div>

    <div class="debug-section solution-section">
        <h2>âœ… Solution Implementation</h2>
        <p>Here's what needs to be fixed in the main UI code:</p>
        
        <h3>ğŸ”§ Code Issues Found</h3>
        <pre class="debug-output">
// âŒ PROBLEM: Hardcoded values in ui/index.html around line 1940
const templateParams = {
  platform: platformSelect.value || <span class="issue-highlight">'jira'</span>, // Falls back to hardcoded 'jira'
  documentType: documentType || <span class="issue-highlight">'component'</span>, // Falls back to hardcoded 'component' 
  teamStandards: {
    tech_stack: techStackDesc ? techStackDesc.split(',').map(s => s.trim()) : <span class="issue-highlight">['React', 'TypeScript']</span>, // Hardcoded React fallback
    testing_framework: <span class="issue-highlight">'jest-rtl'</span>, // Always jest-rtl regardless of tech stack
    accessibility_level: 'wcag-aa',
    documentation_format: 'markdown',
    code_style: 'prettier'
  }
};

// âœ… SOLUTION: Proper dynamic selection
const templateParams = {
  platform: platformSelect.value || 'jira',
  documentType: documentType, // Don't provide fallback, let server handle
  teamStandards: generateTeamStandardsFromTechStack(techStackDesc, documentType)
};
        </pre>
        
        <h3>ğŸ› ï¸ Required Changes</h3>
        <ol>
            <li><strong>Remove hardcoded fallbacks</strong> in templateParams</li>
            <li><strong>Create dynamic tech stack parser</strong> that maps AEM â†’ AEM templates</li>
            <li><strong>Fix document type selection</strong> to use actual dropdown values</li>
            <li><strong>Add template validation</strong> before sending to MCP server</li>
        </ol>
    </div>

    <div class="debug-section">
        <h2>ğŸ“‹ Mock MCP Server Response</h2>
        <p>This simulates what the server should return based on your selections:</p>
        <div id="mockResponse" class="debug-output"></div>
        <button onclick="generateMockTicket()">ğŸ« Generate Mock Ticket</button>
    </div>

    <script>
        // Suppress console warnings like in main UI
        (function() {
            const originalWarn = console.warn;
            console.warn = function(...args) {
                const message = args.join(' ');
                if (message.includes('[Violation] Potential permissions policy violation') ||
                    message.includes('permissions policy violation')) {
                    return;
                }
                originalWarn.apply(console, args);
            };
        })();

        function debugTemplateSelection() {
            const techStack = document.getElementById('techStack').value;
            const docType = document.getElementById('documentType').value;
            const platform = document.getElementById('platform').value;
            
            const output = document.getElementById('debugOutput');
            
            const analysis = analyzeTemplateSelection(techStack, docType, platform);
            
            output.innerHTML = `
<span style="color: #00ff00;">ğŸ” TEMPLATE SELECTION DEBUG</span>
<span style="color: #ffff00;">â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•</span>

<span style="color: #00ffff;">ğŸ“‹ USER SELECTIONS:</span>
â”œâ”€â”€ Tech Stack: ${techStack || '<span style="color: #ff0000;">âŒ NOT SELECTED</span>'}
â”œâ”€â”€ Document Type: ${docType || '<span style="color: #ff0000;">âŒ NOT SELECTED</span>'}
â””â”€â”€ Platform: ${platform || '<span style="color: #ff0000;">âŒ NOT SELECTED</span>'}

<span style="color: #00ffff;">ğŸ¯ TEMPLATE ANALYSIS:</span>
â”œâ”€â”€ Detected Framework: <span style="color: ${analysis.framework === 'Unknown' ? '#ff0000' : '#00ff00'}">${analysis.framework}</span>
â”œâ”€â”€ Template Category: <span style="color: #00ff00;">${analysis.category}</span>
â”œâ”€â”€ Expected Template: <span style="color: #00ff00;">${analysis.expectedTemplate}</span>
â””â”€â”€ Confidence Level: <span style="color: ${analysis.confidence > 80 ? '#00ff00' : '#ffff00'}">${analysis.confidence}%</span>

<span style="color: #00ffff;">âš™ï¸ MCP PARAMETERS THAT SHOULD BE SENT:</span>
<pre style="color: #ffffff; margin-left: 10px;">${JSON.stringify(analysis.mcpParams, null, 2)}</pre>

<span style="color: #00ffff;">ğŸ› CURRENT ISSUES:</span>
${analysis.issues.map(issue => `<span style="color: #ff6666;">âŒ ${issue}</span>`).join('\n')}

<span style="color: #00ffff;">âœ… RECOMMENDED FIXES:</span>
${analysis.fixes.map(fix => `<span style="color: #66ff66;">âœ“ ${fix}</span>`).join('\n')}
            `;
        }

        function analyzeTemplateSelection(techStack, docType, platform) {
            const analysis = {
                framework: 'Unknown',
                category: 'generic',
                expectedTemplate: 'generic-component',
                confidence: 0,
                mcpParams: {},
                issues: [],
                fixes: []
            };

            // Analyze tech stack
            if (techStack.includes('AEM') || techStack.includes('HTL') || techStack.includes('Sling')) {
                analysis.framework = 'AEM';
                analysis.category = 'enterprise-cms';
                analysis.confidence = 95;
            } else if (techStack.includes('React')) {
                analysis.framework = 'React';
                analysis.category = 'spa-framework';
                analysis.confidence = 90;
            } else if (techStack.includes('Vue')) {
                analysis.framework = 'Vue';
                analysis.category = 'spa-framework'; 
                analysis.confidence = 90;
            } else if (techStack.includes('Angular')) {
                analysis.framework = 'Angular';
                analysis.category = 'spa-framework';
                analysis.confidence = 90;
            } else if (!techStack) {
                analysis.issues.push('No tech stack selected - will default to React fallback');
                analysis.fixes.push('Select a tech stack from the dropdown');
            }

            // Analyze document type
            if (!docType) {
                analysis.issues.push('No document type selected - will default to component spec');
                analysis.fixes.push('Select a document type (wiki, component, jira, etc.)');
            } else {
                analysis.expectedTemplate = `${analysis.framework.toLowerCase()}-${docType}`;
            }

            // Build expected MCP parameters
            analysis.mcpParams = {
                platform: platform || 'jira',
                documentType: docType || 'component',
                teamStandards: generateTeamStandards(analysis.framework, docType)
            };

            // Check for hardcoding issues
            if (!platform) {
                analysis.issues.push('Platform defaults to hardcoded "jira"');
                analysis.fixes.push('Fix platform selection logic in UI');
            }

            if (analysis.framework === 'AEM' && analysis.mcpParams.teamStandards.testing_framework === 'jest-rtl') {
                analysis.issues.push('AEM tech stack using React testing framework (jest-rtl)');
                analysis.fixes.push('Map AEM to AEM-specific testing tools (aem-mocks, wcm.io)');
            }

            return analysis;
        }

        function generateTeamStandards(framework, docType) {
            const standards = {
                tech_stack: ['Generic'],
                testing_framework: 'generic',
                accessibility_level: 'wcag-aa',
                documentation_format: 'markdown',
                code_style: 'prettier'
            };

            switch (framework) {
                case 'AEM':
                    standards.tech_stack = ['AEM 6.5', 'HTL', 'Sling Models', 'OSGi', 'Touch UI'];
                    standards.testing_framework = 'aem-mocks';
                    standards.build_tool = 'Maven';
                    standards.deployment = 'AEM Package Manager';
                    break;
                case 'React':
                    standards.tech_stack = ['React', 'TypeScript', 'Vite'];
                    standards.testing_framework = 'jest-rtl';
                    standards.build_tool = 'Vite';
                    break;
                case 'Vue':
                    standards.tech_stack = ['Vue 3', 'TypeScript', 'Vite'];
                    standards.testing_framework = 'vitest';
                    standards.build_tool = 'Vite';
                    break;
                case 'Angular':
                    standards.tech_stack = ['Angular', 'TypeScript', 'Angular CLI'];
                    standards.testing_framework = 'jasmine-karma';
                    standards.build_tool = 'Angular CLI';
                    break;
            }

            return standards;
        }

        function testMCPParameters() {
            const techStack = document.getElementById('techStack').value;
            const docType = document.getElementById('documentType').value;
            const platform = document.getElementById('platform').value;

            const currentParams = {
                // This simulates the BROKEN current implementation
                platform: platform || 'jira', // âŒ Hardcoded fallback
                documentType: docType || 'component', // âŒ Hardcoded fallback
                teamStandards: {
                    tech_stack: techStack ? techStack.split(',').map(s => s.trim()) : ['React', 'TypeScript'], // âŒ React fallback
                    testing_framework: 'jest-rtl', // âŒ Always React testing
                    accessibility_level: 'wcag-aa',
                    documentation_format: 'markdown',
                    code_style: 'prettier'
                }
            };

            const fixedParams = {
                // This is how it SHOULD work
                platform: platform,
                documentType: docType,
                teamStandards: generateTeamStandards(
                    techStack.includes('AEM') ? 'AEM' : 
                    techStack.includes('React') ? 'React' :
                    techStack.includes('Vue') ? 'Vue' :
                    techStack.includes('Angular') ? 'Angular' : 'Generic',
                    docType
                )
            };

            const output = document.getElementById('debugOutput');
            output.innerHTML = `
<span style="color: #ffff00;">ğŸ§ª MCP PARAMETER COMPARISON</span>
<span style="color: #ffff00;">â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•</span>

<span style="color: #ff6666;">âŒ CURRENT (BROKEN) PARAMETERS:</span>
<pre style="color: #ff6666; margin-left: 10px;">${JSON.stringify(currentParams, null, 2)}</pre>

<span style="color: #66ff66;">âœ… FIXED PARAMETERS:</span>  
<pre style="color: #66ff66; margin-left: 10px;">${JSON.stringify(fixedParams, null, 2)}</pre>

<span style="color: #00ffff;">ğŸ”„ KEY DIFFERENCES:</span>
${JSON.stringify(currentParams) === JSON.stringify(fixedParams) ? 
    '<span style="color: #66ff66;">âœ… No differences - parameters are correct!</span>' :
    `
â”œâ”€â”€ Platform: ${currentParams.platform === fixedParams.platform ? 'âœ… Same' : 'âŒ Different'}
â”œâ”€â”€ Document Type: ${currentParams.documentType === fixedParams.documentType ? 'âœ… Same' : 'âŒ Different'}  
â”œâ”€â”€ Tech Stack: ${JSON.stringify(currentParams.teamStandards.tech_stack) === JSON.stringify(fixedParams.teamStandards.tech_stack) ? 'âœ… Same' : 'âŒ Different'}
â””â”€â”€ Testing Framework: ${currentParams.teamStandards.testing_framework === fixedParams.teamStandards.testing_framework ? 'âœ… Same' : 'âŒ Different'}
`}
            `;
        }

        function compareTemplates() {
            const output = document.getElementById('debugOutput');
            output.innerHTML = `
<span style="color: #ffff00;">ğŸ“Š TEMPLATE COMPARISON</span>
<span style="color: #ffff00;">â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•</span>

<span style="color: #00ffff;">ğŸ¯ AEM + WIKI SELECTION SHOULD GENERATE:</span>
<pre style="color: #66ff66;">
# ğŸ“š AEM Component Guide: Why Solidigm?

## ğŸ—ï¸ HTL Implementation
- Create Sling Model for data binding
- Define Touch UI component dialog
- Configure OSGi service integration

## ğŸ“ Component Structure
\`\`\`
/apps/solidigm/components/content/why-solidigm/
â”œâ”€â”€ .content.xml
â”œâ”€â”€ _cq_dialog.xml
â”œâ”€â”€ why-solidigm.html (HTL template)
â””â”€â”€ WyySoldigmModel.java (Sling Model)
\`\`\`

## ğŸ§ª Testing Strategy
- AEM Mocks for unit testing
- wcm.io testing framework
- Component validation with AEM Rules

## ğŸš€ Deployment
- Build with Maven
- Deploy via AEM Package Manager
- Test in AEM author/publish instances
</pre>

<span style="color: #ff6666;">âŒ CURRENT OUTPUT (WRONG TEMPLATE):</span>
<pre style="color: #ff6666;">
# ğŸ“š Guide: Why Solidigm?

## âœ… Acceptance Criteria
âœ… Visual Accuracy: Component matches design specifications exactly
ğŸ“± Responsive Design: Works across all supported breakpoints
â™¿ Accessibility: Meets WCAG-AA standards
ğŸ¨ Design System Compliance: Uses approved design tokens
ğŸ§ª Testing: Unit tests with jest-rtl

## ğŸ§ª Testing Strategy
Framework: Jest + React Testing Library
Test Types: Unit tests, integration tests, snapshot tests
Coverage: Component behavior, props validation, accessibility
</pre>

<span style="color: #00ffff;">ğŸ” ANALYSIS:</span>
â”œâ”€â”€ <span style="color: #ff6666;">âŒ Wrong framework detected (React instead of AEM)</span>
â”œâ”€â”€ <span style="color: #ff6666;">âŒ Wrong testing tools (Jest instead of AEM Mocks)</span>
â”œâ”€â”€ <span style="color: #ff6666;">âŒ Wrong file structure (JSX instead of HTL)</span>
â””â”€â”€ <span style="color: #ff6666;">âŒ Wrong deployment method (NPM instead of Maven)</span>
            `;
        }

        function generateMockTicket() {
            const techStack = document.getElementById('techStack').value;
            const docType = document.getElementById('documentType').value;
            const platform = document.getElementById('platform').value;

            if (!techStack || !docType) {
                document.getElementById('mockResponse').innerHTML = `
<span style="color: #ff6666;">âŒ Please select both Tech Stack and Document Type first!</span>
                `;
                return;
            }

            const isAEM = techStack.includes('AEM');
            const isWiki = docType === 'wiki';

            let mockTicket = '';

            if (isAEM && isWiki) {
                mockTicket = `
<span style="color: #66ff66;">âœ… CORRECT AEM WIKI TEMPLATE:</span>

# ğŸ“š AEM Component Guide: Why Solidigm?

**Component Type**: Touch UI Component | **AEM Version**: 6.5

## ğŸ—ï¸ HTL Implementation

### Sling Model
\`\`\`java
@Model(adaptables = Resource.class, defaultInjectionStrategy = DefaultInjectionStrategy.OPTIONAL)
public class WhySolidgmModel {
    
    @ValueMapValue
    private String title;
    
    @ValueMapValue
    private String description;
    
    // Getters and business logic
}
\`\`\`

### HTL Template (\`why-solidigm.html\`)
\`\`\`html
<div data-sly-use.model="com.solidigm.core.models.WhySolidgmModel" class="why-solidigm">
    <h2>\${model.title}</h2>
    <p>\${model.description}</p>
</div>
\`\`\`

## ğŸ›ï¸ Touch UI Dialog Configuration
- Title field (textfield)
- Description field (textarea)
- Image selection (pathfield)

## ğŸ§ª Testing Strategy
- **Unit Tests**: AEM Mocks + JUnit 5
- **Integration Tests**: wcm.io testing framework
- **Component Validation**: AEM Rules Engine

## ğŸš€ Build & Deployment
- **Build Tool**: Maven
- **Package**: AEM Content Package
- **Deployment**: Package Manager or AEM CLI
                `;
            } else if (techStack.includes('React') && docType === 'component') {
                mockTicket = `
<span style="color: #66ff66;">âœ… CORRECT REACT COMPONENT TEMPLATE:</span>

# ğŸ§© React Component: Why Solidigm?

**Framework**: React 18 + TypeScript | **Build**: Vite

## ğŸ—ï¸ Component Implementation

\`\`\`typescript
interface WhySolidgmProps {
  title: string;
  description: string;
  imageUrl?: string;
}

export const WhySolidgm: React.FC<WhySolidgmProps> = ({ 
  title, 
  description, 
  imageUrl 
}) => {
  return (
    <div className="why-solidgm">
      <h2>{title}</h2>
      <p>{description}</p>
      {imageUrl && <img src={imageUrl} alt={title} />}
    </div>
  );
};
\`\`\`

## ğŸ§ª Testing Strategy
- **Framework**: Jest + React Testing Library
- **Coverage**: Component render, props, interactions
- **Accessibility**: @testing-library/jest-dom a11y tests

## âœ… Acceptance Criteria
- TypeScript strict mode compliance
- 100% test coverage
- Responsive design implementation
- WCAG-AA accessibility standards
                `;
            } else {
                mockTicket = `
<span style="color: #ffff00;">âš ï¸ GENERIC TEMPLATE (FALLBACK):</span>

# ğŸ“‹ Component: Why Solidigm?

**Tech Stack**: ${techStack}
**Document Type**: ${docType}
**Platform**: ${platform}

This would be a generic template since no specific template
mapping exists for this combination.

<span style="color: #00ffff;">ğŸ’¡ To get specific templates, try:</span>
- AEM + Wiki = AEM-specific guide with HTL/Sling
- React + Component = React TypeScript component spec
- Vue + Component = Vue 3 Composition API spec
- Angular + Component = Angular component specification
                `;
            }

            document.getElementById('mockResponse').innerHTML = mockTicket;
        }

        // Auto-populate for demonstration
        window.addEventListener('load', () => {
            document.getElementById('techStack').value = 'AEM 6.5 with HTL (HTML Template Language), Apache Sling framework, OSGi bundles, JCR repository, Touch UI components';
            document.getElementById('documentType').value = 'wiki';
            document.getElementById('platform').value = 'jira';
            
            setTimeout(() => {
                debugTemplateSelection();
            }, 500);
        });
    </script>
</body>
</html>