<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Parse Tech Stack Test</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            padding: 20px;
            max-width: 800px;
            margin: 0 auto;
        }
        .test-container {
            border: 1px solid #ddd;
            padding: 20px;
            margin: 20px 0;
            border-radius: 8px;
        }
        .tech-stack-input {
            width: 100%;
            height: 120px;
            margin: 10px 0;
            padding: 10px;
            border: 1px solid #ccc;
            border-radius: 4px;
            font-family: monospace;
        }
        .parse-button {
            background: #007acc;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 4px;
            cursor: pointer;
            margin: 10px 5px;
        }
        .parse-button:hover {
            background: #005a9e;
        }
        .status-section {
            margin: 20px 0;
            padding: 15px;
            background: #f5f5f5;
            border-radius: 4px;
            display: none;
        }
        .confidence-indicator {
            margin: 10px 0;
        }
        .confidence-score {
            font-weight: bold;
            padding: 2px 8px;
            border-radius: 3px;
        }
        .confidence-high { background: #d4edda; color: #155724; }
        .confidence-medium { background: #fff3cd; color: #856404; }
        .confidence-low { background: #f8d7da; color: #721c24; }
        .suggestions {
            margin: 10px 0;
        }
        .suggestion-pill {
            display: inline-block;
            background: #e9ecef;
            padding: 4px 8px;
            margin: 2px;
            border-radius: 12px;
            font-size: 0.9em;
        }
        .log {
            background: #f8f9fa;
            border: 1px solid #dee2e6;
            padding: 10px;
            margin: 10px 0;
            border-radius: 4px;
            font-family: monospace;
            font-size: 0.9em;
            max-height: 200px;
            overflow-y: auto;
        }
    </style>
</head>
<body>
    <h1>Parse Tech Stack Button Test</h1>
    
    <div class="test-container">
        <h2>Test Input</h2>
        <textarea class="tech-stack-input" id="techStackInput" placeholder="Enter tech stack information here...">
React 18.2, TypeScript 4.9, Node.js 18, Express 4.18, MongoDB 6.0, 
Tailwind CSS 3.2, Webpack 5.75, Jest 29.3, ESLint 8.28, Prettier 2.8

Frontend: React with TypeScript for component development
Backend: Node.js with Express framework for REST API
Database: MongoDB for document storage
Styling: Tailwind CSS for utility-first styling
Testing: Jest for unit and integration testing
Build: Webpack for module bundling and optimization
</textarea>
        
        <button class="parse-button" id="parseTechStackBtn">Parse Tech Stack</button>
        <button class="parse-button" onclick="clearLog()">Clear Log</button>
        
        <div class="status-section" id="statusSection">
            <div class="confidence-indicator">
                <span>ðŸ“Š Confidence:</span>
                <span class="confidence-score" id="confidenceScore">0%</span>
            </div>
            <div class="suggestions" id="suggestions">
                <!-- Suggestions will appear here -->
            </div>
        </div>
        
        <div class="log" id="log"></div>
    </div>

    <script>
        // Logging utility
        function log(message) {
            const logEl = document.getElementById('log');
            const timestamp = new Date().toLocaleTimeString();
            logEl.innerHTML += `[${timestamp}] ${message}<br>`;
            logEl.scrollTop = logEl.scrollHeight;
            console.log(`[Parse Tech Stack Test] ${message}`);
        }

        function clearLog() {
            document.getElementById('log').innerHTML = '';
        }

        // Get elements
        const techStackInput = document.getElementById('techStackInput');
        const statusSection = document.getElementById('statusSection');
        
        log('Initializing Parse Tech Stack Test...');
        log('Elements found: ' + (techStackInput ? 'techStackInput âœ“' : 'techStackInput âœ—') + ', ' + (statusSection ? 'statusSection âœ“' : 'statusSection âœ—'));

        // Tech Stack Suggestions Database (simplified version)
        const techStackSuggestions = {
            'react': { confidence: 95, category: 'frontend', suggestions: ['Add testing with Jest', 'Consider state management'] },
            'typescript': { confidence: 90, category: 'language', suggestions: ['Configure strict mode', 'Add type definitions'] },
            'node.js': { confidence: 95, category: 'backend', suggestions: ['Add error handling', 'Configure clustering'] },
            'express': { confidence: 90, category: 'framework', suggestions: ['Add middleware', 'Configure CORS'] },
            'mongodb': { confidence: 85, category: 'database', suggestions: ['Add indexing strategy', 'Configure connection pooling'] }
        };

        // Parse tech stack function
        function parseTechStack(input) {
            log('parseTechStack() called with input length: ' + input.length);
            
            if (!input || input.trim().length === 0) {
                log('Error: Empty input provided');
                showError('Please enter tech stack information');
                return null;
            }
            
            const inputLower = input.toLowerCase();
            log('Processing input: ' + inputLower.substring(0, 100) + '...');
            
            let totalConfidence = 0;
            let matchCount = 0;
            const detectedTech = [];
            const suggestions = [];
            
            // Check for each technology in our database
            for (const [tech, data] of Object.entries(techStackSuggestions)) {
                if (inputLower.includes(tech)) {
                    log(`Detected technology: ${tech} (confidence: ${data.confidence}%)`);
                    detectedTech.push({ name: tech, ...data });
                    totalConfidence += data.confidence;
                    matchCount++;
                    suggestions.push(...data.suggestions);
                }
            }
            
            // Calculate average confidence
            const confidence = matchCount > 0 ? Math.round(totalConfidence / matchCount) : 0;
            log(`Analysis complete. Detected ${matchCount} technologies, average confidence: ${confidence}%`);
            
            const result = {
                confidence,
                detectedTech,
                suggestions: [...new Set(suggestions)].slice(0, 5) // Remove duplicates and limit to 5
            };
            
            log('Parse result: ' + JSON.stringify(result, null, 2));
            return result;
        }

        // Update confidence indicator function
        function updateConfidenceIndicator(confidence, suggestions = []) {
            log(`updateConfidenceIndicator() called with confidence: ${confidence}%, suggestions: ${suggestions.length}`);
            
            const scoreEl = statusSection.querySelector('.confidence-score');
            const suggestionsEl = statusSection.querySelector('.suggestions');
            
            if (!scoreEl || !suggestionsEl) {
                log('Error: Could not find confidence score or suggestions elements');
                return;
            }
            
            scoreEl.textContent = `${confidence}%`;
            scoreEl.className = `confidence-score ${
                confidence >= 80 ? 'confidence-high' : 
                confidence >= 60 ? 'confidence-medium' : 'confidence-low'
            }`;
            
            suggestionsEl.innerHTML = suggestions.map(s => 
                `<span class="suggestion-pill">${s}</span>`
            ).join('');
            
            statusSection.style.display = 'block';
            log(`Status section updated and made visible`);
        }

        // Show error function
        function showError(message) {
            log(`showError() called: ${message}`);
            alert('Error: ' + message);
        }

        // Parse tech stack manually function
        function parseTechStackManually() {
            log('parseTechStackManually() called');
            
            const input = techStackInput.value;
            log(`Input value: "${input.substring(0, 50)}..."`);
            
            if (!input || input.trim().length === 0) {
                log('Input validation failed: empty input');
                showError('Please enter tech stack information');
                return;
            }
            
            try {
                const parsed = parseTechStack(input);
                if (parsed) {
                    log('Parse successful, updating confidence indicator...');
                    updateConfidenceIndicator(parsed.confidence, parsed.suggestions);
                } else {
                    log('Parse failed, result was null');
                    showError('Failed to parse tech stack');
                }
            } catch (error) {
                log('Exception occurred: ' + error.message);
                showError('Error parsing tech stack: ' + error.message);
            }
        }

        // Add event listener
        document.getElementById('parseTechStackBtn').addEventListener('click', function() {
            log('Parse Tech Stack button clicked');
            parseTechStackManually();
        });

        log('Event listener attached to Parse Tech Stack button');
        log('Test setup complete. Ready to test!');
    </script>
</body>
</html>