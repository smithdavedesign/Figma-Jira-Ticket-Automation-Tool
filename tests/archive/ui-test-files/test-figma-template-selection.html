<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>üéØ Figma Template Selection Test</title>
  <style>
    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', sans-serif;
      line-height: 1.6;
      background: #f8fafc;
      color: #1a202c;
      padding: 20px;
    }

    .test-container {
      max-width: 1000px;
      margin: 0 auto;
      background: white;
      border-radius: 12px;
      box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
      overflow: hidden;
    }

    .test-header {
      background: linear-gradient(135deg, #059669 0%, #10b981 100%);
      color: white;
      padding: 24px;
      text-align: center;
    }

    .test-section {
      padding: 24px;
      border-bottom: 1px solid #e2e8f0;
    }

    .test-section:last-child {
      border-bottom: none;
    }

    .test-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
      gap: 20px;
      margin-bottom: 20px;
    }

    .test-card {
      border: 1px solid #e2e8f0;
      border-radius: 8px;
      overflow: hidden;
      transition: all 0.2s ease;
    }

    .test-card:hover {
      border-color: #cbd5e1;
      box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);
    }

    .test-card-header {
      background: #f8fafc;
      padding: 12px 16px;
      border-bottom: 1px solid #e2e8f0;
      font-weight: 500;
      color: #374151;
    }

    .test-card-body {
      padding: 16px;
    }

    .test-button {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
      border: none;
      padding: 10px 16px;
      border-radius: 6px;
      font-size: 14px;
      font-weight: 500;
      cursor: pointer;
      transition: all 0.2s ease;
      width: 100%;
      margin-bottom: 12px;
    }

    .test-button:hover {
      transform: translateY(-1px);
      box-shadow: 0 4px 12px rgba(102, 126, 234, 0.3);
    }

    .test-result {
      margin-top: 12px;
      padding: 12px;
      border-radius: 6px;
      font-size: 13px;
      display: none;
    }

    .test-result.success {
      background: #ecfdf5;
      color: #065f46;
      border: 1px solid #a7f3d0;
      display: block;
    }

    .test-result.error {
      background: #fef2f2;
      color: #991b1b;
      border: 1px solid #fecaca;
      display: block;
    }

    .test-result.info {
      background: #eff6ff;
      color: #1e40af;
      border: 1px solid #bfdbfe;
      display: block;
    }

    .console-output {
      background: #1e293b;
      color: #e2e8f0;
      padding: 16px;
      border-radius: 8px;
      font-family: 'SF Mono', Monaco, monospace;
      font-size: 12px;
      overflow-x: auto;
      max-height: 300px;
      overflow-y: auto;
    }

    pre {
      background: #f1f5f9;
      border: 1px solid #cbd5e1;
      border-radius: 6px;
      padding: 12px;
      overflow-x: auto;
      font-size: 12px;
    }

    .tech-stack-input {
      width: 100%;
      min-height: 60px;
      padding: 12px;
      border: 1px solid #d1d5db;
      border-radius: 6px;
      font-size: 14px;
      resize: vertical;
    }

    .template-result {
      background: #f8fafc;
      border: 1px solid #e2e8f0;
      border-radius: 6px;
      padding: 12px;
      margin-top: 12px;
      font-family: monospace;
      font-size: 12px;
    }
  </style>
</head>
<body>
  <div class="test-container">
    <div class="test-header">
      <h1>üéØ Figma Template Selection Test</h1>
      <p>Testing template selection logic for AEM, React, Vue, and other tech stacks with real Figma context</p>
    </div>

    <!-- MCP Server Test for Template Selection -->
    <div class="test-section">
      <h2>ü§ñ MCP Server Template Selection Tests</h2>
      <div class="test-grid">
        <div class="test-card">
          <div class="test-card-header">AEM Template Selection Test</div>
          <div class="test-card-body">
            <button class="test-button" onclick="testAEMTemplateSelection()">Test AEM Template Logic</button>
            <div id="aem-template-result" class="test-result"></div>
          </div>
        </div>
        <div class="test-card">
          <div class="test-card-header">React Template Selection Test</div>
          <div class="test-card-body">
            <button class="test-button" onclick="testReactTemplateSelection()">Test React Template Logic</button>
            <div id="react-template-result" class="test-result"></div>
          </div>
        </div>
        <div class="test-card">
          <div class="test-card-header">Vue Template Selection Test</div>
          <div class="test-card-body">
            <button class="test-button" onclick="testVueTemplateSelection()">Test Vue Template Logic</button>
            <div id="vue-template-result" class="test-result"></div>
          </div>
        </div>
        <div class="test-card">
          <div class="test-card-header">Full Template Suite Test</div>
          <div class="test-card-body">
            <button class="test-button" onclick="testAllTemplateSelections()">Test All Template Selections</button>
            <div id="all-templates-result" class="test-result"></div>
          </div>
        </div>
      </div>
    </div>

    <!-- Interactive Template Selection Test -->
    <div class="test-section">
      <h2>üß™ Interactive Template Selection Test</h2>
      <div class="test-card">
        <div class="test-card-header">Custom Tech Stack Template Test</div>
        <div class="test-card-body">
          <label for="custom-tech-stack">Enter Tech Stack:</label>
          <textarea id="custom-tech-stack" class="tech-stack-input" placeholder="Enter your tech stack description here (e.g., 'AEM 6.5 with HTL and Sling framework' or 'React 18 with TypeScript')"></textarea>
          <button class="test-button" onclick="testCustomTechStack()">Test Custom Tech Stack</button>
          <div id="custom-template-result" class="test-result"></div>
        </div>
      </div>
    </div>

    <!-- Live Figma Integration Test -->
    <div class="test-section">
      <h2>üîó Live Figma Integration Test</h2>
      <div class="test-grid">
        <div class="test-card">
          <div class="test-card-header">Generate Real Figma Ticket - AEM</div>
          <div class="test-card-body">
            <button class="test-button" onclick="testLiveFigmaAEM()">Generate AEM Ticket from Figma</button>
            <div id="live-figma-aem-result" class="test-result"></div>
          </div>
        </div>
        <div class="test-card">
          <div class="test-card-header">Generate Real Figma Ticket - React</div>
          <div class="test-card-body">
            <button class="test-button" onclick="testLiveFigmaReact()">Generate React Ticket from Figma</button>
            <div id="live-figma-react-result" class="test-result"></div>
          </div>
        </div>
      </div>
    </div>

    <!-- Template Content Verification -->
    <div class="test-section">
      <h2>üìã Template Content Verification</h2>
      <div class="test-grid">
        <div class="test-card">
          <div class="test-card-header">AEM Template Content Check</div>
          <div class="test-card-body">
            <button class="test-button" onclick="verifyAEMTemplateContent()">Verify AEM Template Content</button>
            <div id="aem-content-result" class="test-result"></div>
          </div>
        </div>
        <div class="test-card">
          <div class="test-card-header">Component Template Content Check</div>
          <div class="test-card-body">
            <button class="test-button" onclick="verifyComponentTemplateContent()">Verify Component Template Content</button>
            <div id="component-content-result" class="test-result"></div>
          </div>
        </div>
      </div>
    </div>

    <!-- Console Output -->
    <div class="test-section">
      <h2>üìã Test Console Output</h2>
      <div class="console-output" id="console-output">
        üéØ Figma Template Selection Test Suite Ready<br>
        Click any test button to validate template selection logic...
      </div>
    </div>
  </div>

  <script>
    const consoleOutput = document.getElementById('console-output');
    
    function log(message, type = 'info') {
      const timestamp = new Date().toLocaleTimeString();
      const emoji = type === 'success' ? '‚úÖ' : type === 'error' ? '‚ùå' : type === 'warning' ? '‚ö†Ô∏è' : '‚ÑπÔ∏è';
      consoleOutput.innerHTML += `${emoji} [${timestamp}] ${message}<br>`;
      consoleOutput.scrollTop = consoleOutput.scrollHeight;
      console.log(`${emoji} ${message}`);
    }

    function showResult(elementId, message, type) {
      const element = document.getElementById(elementId);
      element.textContent = message;
      element.className = `test-result ${type}`;
    }

    // Template selection logic - matches the real implementation
    function determineDocumentType(techStack, defaultType = 'component') {
      if (!techStack) return defaultType;
      
      const techStackLower = techStack.toLowerCase();
      
      // AEM-specific document type logic
      if (techStackLower.includes('aem')) {
        if (techStackLower.includes('component') || techStackLower.includes('htl')) {
          return 'component-aem';
        }
        if (techStackLower.includes('page') || techStackLower.includes('template')) {
          return 'page-aem';
        }
        if (techStackLower.includes('service') || techStackLower.includes('osgi')) {
          return 'service-aem';
        }
        return 'component-aem'; // Default AEM type
      }
      
      // Standard document types for other tech stacks
      if (techStackLower.includes('service') || techStackLower.includes('api')) {
        return 'service';
      }
      if (techStackLower.includes('feature') || techStackLower.includes('flow')) {
        return 'feature';
      }
      
      return defaultType; // Default to component
    }

    // AEM Template Selection Test
    async function testAEMTemplateSelection() {
      log('üîç Testing AEM template selection logic...', 'info');
      
      const aemTestCases = [
        {
          techStack: 'AEM 6.5 with HTL (HTML Template Language), Apache Sling framework',
          expected: 'component-aem',
          description: 'AEM with HTL'
        },
        {
          techStack: 'Adobe Experience Manager, OSGi services, JCR repository',
          expected: 'component-aem',
          description: 'AEM with OSGi'
        },
        {
          techStack: 'AEM page template with Sling Models',
          expected: 'page-aem',
          description: 'AEM page template'
        },
        {
          techStack: 'AEM service implementation with OSGi',
          expected: 'service-aem',
          description: 'AEM service'
        }
      ];

      let passedTests = 0;
      let results = [];

      for (const testCase of aemTestCases) {
        const detected = determineDocumentType(testCase.techStack);
        const passed = detected === testCase.expected;
        
        if (passed) {
          passedTests++;
          log(`‚úÖ ${testCase.description}: ${detected}`, 'success');
        } else {
          log(`‚ùå ${testCase.description}: Expected ${testCase.expected}, got ${detected}`, 'error');
        }
        
        results.push({
          case: testCase.description,
          expected: testCase.expected,
          actual: detected,
          passed
        });
      }

      // Test with MCP server
      try {
        log('ü§ñ Testing with MCP server...', 'info');
        const mcpResponse = await fetch('http://localhost:3000/', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({
            method: 'generate_enhanced_ticket',
            params: {
              figmaUrl: 'https://www.figma.com/file/test/AEM-Component',
              techStack: 'AEM 6.5 with HTL (HTML Template Language), Apache Sling framework',
              platform: 'jira',
              documentType: 'component',
              standaloneMode: true
            }
          })
        });

        if (mcpResponse.ok) {
          const mcpResult = await mcpResponse.json();
          log('‚úÖ MCP server responded successfully for AEM template', 'success');
          
          // Check if the response contains AEM-specific content
          const responseText = mcpResult.content?.[0]?.text || '';
          const hasAEMContent = responseText.includes('HTL') || 
                               responseText.includes('Sling') || 
                               responseText.includes('AEM') ||
                               responseText.includes('component-aem');
          
          if (hasAEMContent) {
            log('‚úÖ Generated content contains AEM-specific terms', 'success');
          } else {
            log('‚ö†Ô∏è Generated content may not be AEM-specific', 'warning');
          }
        } else {
          log('‚ùå MCP server test failed', 'error');
        }
      } catch (error) {
        log(`‚ö†Ô∏è MCP server test error: ${error.message}`, 'warning');
      }

      const successRate = Math.round((passedTests / aemTestCases.length) * 100);
      showResult('aem-template-result', 
        `‚úÖ AEM Template Selection: ${passedTests}/${aemTestCases.length} tests passed (${successRate}%)`, 
        passedTests === aemTestCases.length ? 'success' : 'error'
      );
    }

    // React Template Selection Test
    async function testReactTemplateSelection() {
      log('‚öõÔ∏è Testing React template selection logic...', 'info');
      
      const reactTestCases = [
        {
          techStack: 'React 18 with TypeScript, Material-UI',
          expected: 'component',
          description: 'React with TypeScript'
        },
        {
          techStack: 'Next.js 13 with App Router, React 18',
          expected: 'component',
          description: 'Next.js with React'
        },
        {
          techStack: 'React service layer with Apollo GraphQL',
          expected: 'service',
          description: 'React service'
        },
        {
          techStack: 'React feature implementation with Redux',
          expected: 'feature',
          description: 'React feature'
        }
      ];

      let passedTests = 0;

      for (const testCase of reactTestCases) {
        const detected = determineDocumentType(testCase.techStack);
        const passed = detected === testCase.expected;
        
        if (passed) {
          passedTests++;
          log(`‚úÖ ${testCase.description}: ${detected}`, 'success');
        } else {
          log(`‚ùå ${testCase.description}: Expected ${testCase.expected}, got ${detected}`, 'error');
        }
      }

      // Test with MCP server
      try {
        log('ü§ñ Testing React with MCP server...', 'info');
        const mcpResponse = await fetch('http://localhost:3000/', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({
            method: 'generate_enhanced_ticket',
            params: {
              figmaUrl: 'https://www.figma.com/file/test/React-Component',
              techStack: 'React 18 with TypeScript, Material-UI',
              platform: 'jira',
              documentType: 'component',
              standaloneMode: true
            }
          })
        });

        if (mcpResponse.ok) {
          const mcpResult = await mcpResponse.json();
          log('‚úÖ MCP server responded successfully for React template', 'success');
          
          const responseText = mcpResult.content?.[0]?.text || '';
          const hasReactContent = responseText.includes('React') || 
                                 responseText.includes('TypeScript') || 
                                 responseText.includes('component') ||
                                 responseText.includes('tsx');
          
          if (hasReactContent) {
            log('‚úÖ Generated content contains React-specific terms', 'success');
          }
        }
      } catch (error) {
        log(`‚ö†Ô∏è MCP server test error: ${error.message}`, 'warning');
      }

      const successRate = Math.round((passedTests / reactTestCases.length) * 100);
      showResult('react-template-result', 
        `‚úÖ React Template Selection: ${passedTests}/${reactTestCases.length} tests passed (${successRate}%)`, 
        passedTests === reactTestCases.length ? 'success' : 'error'
      );
    }

    // Vue Template Selection Test
    async function testVueTemplateSelection() {
      log('üíö Testing Vue template selection logic...', 'info');
      
      const vueTestCases = [
        {
          techStack: 'Vue 3 with Composition API, Pinia for state management',
          expected: 'component',
          description: 'Vue 3 with Composition API'
        },
        {
          techStack: 'Nuxt.js 3 with Vue 3, universal SSR',
          expected: 'component',
          description: 'Nuxt.js with Vue'
        },
        {
          techStack: 'Vue service layer with Axios',
          expected: 'service',
          description: 'Vue service'
        },
        {
          techStack: 'Vue feature with Vuex state management',
          expected: 'feature',
          description: 'Vue feature'
        }
      ];

      let passedTests = 0;

      for (const testCase of vueTestCases) {
        const detected = determineDocumentType(testCase.techStack);
        const passed = detected === testCase.expected;
        
        if (passed) {
          passedTests++;
          log(`‚úÖ ${testCase.description}: ${detected}`, 'success');
        } else {
          log(`‚ùå ${testCase.description}: Expected ${testCase.expected}, got ${detected}`, 'error');
        }
      }

      // Test with MCP server
      try {
        log('ü§ñ Testing Vue with MCP server...', 'info');
        const mcpResponse = await fetch('http://localhost:3000/', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({
            method: 'generate_enhanced_ticket',
            params: {
              figmaUrl: 'https://www.figma.com/file/test/Vue-Component',
              techStack: 'Vue 3 with Composition API, Pinia for state management',
              platform: 'jira',
              documentType: 'component',
              standaloneMode: true
            }
          })
        });

        if (mcpResponse.ok) {
          const mcpResult = await mcpResponse.json();
          log('‚úÖ MCP server responded successfully for Vue template', 'success');
          
          const responseText = mcpResult.content?.[0]?.text || '';
          const hasVueContent = responseText.includes('Vue') || 
                               responseText.includes('Composition API') || 
                               responseText.includes('Pinia') ||
                               responseText.includes('.vue');
          
          if (hasVueContent) {
            log('‚úÖ Generated content contains Vue-specific terms', 'success');
          }
        }
      } catch (error) {
        log(`‚ö†Ô∏è MCP server test error: ${error.message}`, 'warning');
      }

      const successRate = Math.round((passedTests / vueTestCases.length) * 100);
      showResult('vue-template-result', 
        `‚úÖ Vue Template Selection: ${passedTests}/${vueTestCases.length} tests passed (${successRate}%)`, 
        passedTests === vueTestCases.length ? 'success' : 'error'
      );
    }

    // Test All Template Selections
    async function testAllTemplateSelections() {
      log('üöÄ Running comprehensive template selection test...', 'info');
      
      // Run all individual tests
      await testAEMTemplateSelection();
      await new Promise(resolve => setTimeout(resolve, 500));
      
      await testReactTemplateSelection();
      await new Promise(resolve => setTimeout(resolve, 500));
      
      await testVueTemplateSelection();
      await new Promise(resolve => setTimeout(resolve, 500));

      // Additional edge cases
      const edgeCases = [
        {
          techStack: '',
          expected: 'component',
          description: 'Empty tech stack (fallback)'
        },
        {
          techStack: 'Custom framework with API services',
          expected: 'service',
          description: 'API service detection'
        },
        {
          techStack: 'Feature implementation with custom tech',
          expected: 'feature',
          description: 'Feature detection'
        }
      ];

      let edgePassed = 0;
      for (const testCase of edgeCases) {
        const detected = determineDocumentType(testCase.techStack);
        const passed = detected === testCase.expected;
        
        if (passed) {
          edgePassed++;
          log(`‚úÖ Edge case - ${testCase.description}: ${detected}`, 'success');
        } else {
          log(`‚ùå Edge case - ${testCase.description}: Expected ${testCase.expected}, got ${detected}`, 'error');
        }
      }

      log('üìä Template Selection Test Summary:', 'info');
      log('   ‚úÖ AEM templates: Checked component-aem, page-aem, service-aem', 'info');
      log('   ‚öõÔ∏è React templates: Checked component, service, feature', 'info');
      log('   üíö Vue templates: Checked component, service, feature', 'info');
      log(`   üéØ Edge cases: ${edgePassed}/3 passed`, 'info');

      showResult('all-templates-result', 
        `‚úÖ Comprehensive Template Selection: All tech stacks tested with template logic`, 
        'success'
      );
    }

    // Custom Tech Stack Test
    async function testCustomTechStack() {
      const customTechStack = document.getElementById('custom-tech-stack').value.trim();
      
      if (!customTechStack) {
        showResult('custom-template-result', '‚ùå Please enter a tech stack description', 'error');
        return;
      }

      log(`üß™ Testing custom tech stack: "${customTechStack}"`, 'info');
      
      // Detect template type
      const detectedType = determineDocumentType(customTechStack);
      log(`üéØ Detected template type: ${detectedType}`, 'info');

      // Test with MCP server
      try {
        log('ü§ñ Testing with MCP server...', 'info');
        const mcpResponse = await fetch('http://localhost:3000/', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({
            method: 'generate_enhanced_ticket',
            params: {
              figmaUrl: 'https://www.figma.com/file/test/Custom-Component',
              techStack: customTechStack,
              platform: 'jira',
              documentType: detectedType,
              standaloneMode: true
            }
          })
        });

        if (mcpResponse.ok) {
          const mcpResult = await mcpResponse.json();
          const responseText = mcpResult.content?.[0]?.text || '';
          const previewText = responseText.substring(0, 200) + '...';
          
          log('‚úÖ MCP server generated ticket successfully', 'success');
          log(`üìù Preview: ${previewText}`, 'info');
          
          showResult('custom-template-result', 
            `‚úÖ Custom Tech Stack Test: Detected "${detectedType}" template, generated ${responseText.length} characters`, 
            'success'
          );
          
          // Add template preview
          const templateDiv = document.createElement('div');
          templateDiv.className = 'template-result';
          templateDiv.innerHTML = `<strong>Template Type:</strong> ${detectedType}<br><strong>Generated Content Preview:</strong><br><pre>${previewText}</pre>`;
          document.getElementById('custom-template-result').appendChild(templateDiv);
          
        } else {
          throw new Error(`HTTP ${mcpResponse.status}`);
        }
      } catch (error) {
        log(`‚ùå MCP server test failed: ${error.message}`, 'error');
        showResult('custom-template-result', 
          `‚úÖ Template Detection: "${detectedType}" but MCP server error: ${error.message}`, 
          'error'
        );
      }
    }

    // Live Figma AEM Test
    async function testLiveFigmaAEM() {
      log('üî• Testing live Figma with AEM template selection...', 'info');
      
      try {
        const mcpResponse = await fetch('http://localhost:3000/', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({
            method: 'generate_enhanced_ticket',
            params: {
              figmaUrl: 'https://www.figma.com/file/BioUSVD6t51ZNeG0g9AcNz/Test-Design',
              techStack: 'AEM 6.5 with HTL (HTML Template Language), Apache Sling framework, Touch UI components',
              platform: 'jira',
              documentType: 'component',
              visualContext: null,
              selectionCount: 1,
              standaloneMode: true
            }
          })
        });

        if (mcpResponse.ok) {
          const result = await mcpResponse.json();
          const generatedContent = result.content?.[0]?.text || '';
          
          // Check for AEM-specific content
          const aemKeywords = ['HTL', 'Sling', 'AEM', 'OSGi', 'JCR', 'Touch UI'];
          const foundKeywords = aemKeywords.filter(keyword => 
            generatedContent.toLowerCase().includes(keyword.toLowerCase())
          );
          
          log(`‚úÖ Live Figma + AEM: Generated ${generatedContent.length} characters`, 'success');
          log(`üéØ AEM keywords found: ${foundKeywords.join(', ')}`, 'success');
          
          showResult('live-figma-aem-result', 
            `‚úÖ Live Figma AEM Test: Generated content with ${foundKeywords.length}/${aemKeywords.length} AEM-specific terms`, 
            'success'
          );
          
          // Show preview
          const preview = generatedContent.substring(0, 300) + '...';
          const templateDiv = document.createElement('div');
          templateDiv.className = 'template-result';
          templateDiv.innerHTML = `<strong>AEM Keywords Found:</strong> ${foundKeywords.join(', ')}<br><strong>Generated Content:</strong><br><pre>${preview}</pre>`;
          document.getElementById('live-figma-aem-result').appendChild(templateDiv);
          
        } else {
          throw new Error(`HTTP ${mcpResponse.status}`);
        }
      } catch (error) {
        log(`‚ùå Live Figma AEM test failed: ${error.message}`, 'error');
        showResult('live-figma-aem-result', `‚ùå Live Figma AEM error: ${error.message}`, 'error');
      }
    }

    // Live Figma React Test
    async function testLiveFigmaReact() {
      log('‚öõÔ∏è Testing live Figma with React template selection...', 'info');
      
      try {
        const mcpResponse = await fetch('http://localhost:3000/', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({
            method: 'generate_enhanced_ticket',
            params: {
              figmaUrl: 'https://www.figma.com/file/BioUSVD6t51ZNeG0g9AcNz/Test-Design',
              techStack: 'React 18 with TypeScript, Material-UI v5, React Query for data fetching, Jest and React Testing Library',
              platform: 'jira',
              documentType: 'component',
              visualContext: null,
              selectionCount: 1,
              standaloneMode: true
            }
          })
        });

        if (mcpResponse.ok) {
          const result = await mcpResponse.json();
          const generatedContent = result.content?.[0]?.text || '';
          
          // Check for React-specific content
          const reactKeywords = ['React', 'TypeScript', 'Material-UI', 'Jest', 'tsx', 'component', 'hooks'];
          const foundKeywords = reactKeywords.filter(keyword => 
            generatedContent.toLowerCase().includes(keyword.toLowerCase())
          );
          
          log(`‚úÖ Live Figma + React: Generated ${generatedContent.length} characters`, 'success');
          log(`‚öõÔ∏è React keywords found: ${foundKeywords.join(', ')}`, 'success');
          
          showResult('live-figma-react-result', 
            `‚úÖ Live Figma React Test: Generated content with ${foundKeywords.length}/${reactKeywords.length} React-specific terms`, 
            'success'
          );
          
          // Show preview
          const preview = generatedContent.substring(0, 300) + '...';
          const templateDiv = document.createElement('div');
          templateDiv.className = 'template-result';
          templateDiv.innerHTML = `<strong>React Keywords Found:</strong> ${foundKeywords.join(', ')}<br><strong>Generated Content:</strong><br><pre>${preview}</pre>`;
          document.getElementById('live-figma-react-result').appendChild(templateDiv);
          
        } else {
          throw new Error(`HTTP ${mcpResponse.status}`);
        }
      } catch (error) {
        log(`‚ùå Live Figma React test failed: ${error.message}`, 'error');
        showResult('live-figma-react-result', `‚ùå Live Figma React error: ${error.message}`, 'error');
      }
    }

    // Verify AEM Template Content
    async function verifyAEMTemplateContent() {
      log('üîç Verifying AEM template content structure...', 'info');
      
      try {
        // Test AEM component template
        const mcpResponse = await fetch('http://localhost:3000/', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({
            method: 'generate_template_tickets',
            params: {
              frameData: [{
                id: 'test-aem-component',
                name: 'AEM Card Component',
                type: 'COMPONENT',
                dimensions: { width: 300, height: 200 }
              }],
              figmaContext: {
                figmaUrl: 'https://www.figma.com/file/test/AEM-Components',
                fileName: 'AEM Design System'
              },
              platform: 'jira',
              documentType: 'component-aem',
              teamStandards: {
                tech_stack: 'AEM 6.5 with HTL, Sling Models, Touch UI'
              }
            }
          })
        });

        if (mcpResponse.ok) {
          const result = await mcpResponse.json();
          const content = result.content?.[0]?.text || '';
          
          // Check for AEM-specific template structure
          const aemStructureChecks = {
            'HTL Template': content.includes('HTL') || content.includes('html'),
            'Sling Model': content.includes('Sling') || content.includes('Model'),
            'Touch UI': content.includes('Touch UI') || content.includes('dialog'),
            'AEM Component': content.includes('AEM') && content.includes('component'),
            'OSGi Bundle': content.includes('OSGi') || content.includes('bundle'),
            'JCR Structure': content.includes('JCR') || content.includes('repository')
          };

          const passedChecks = Object.entries(aemStructureChecks).filter(([_, passed]) => passed);
          
          log(`üìã AEM Template Structure Verification:`, 'info');
          Object.entries(aemStructureChecks).forEach(([check, passed]) => {
            log(`  ${passed ? '‚úÖ' : '‚ùå'} ${check}`, passed ? 'success' : 'error');
          });
          
          showResult('aem-content-result', 
            `‚úÖ AEM Template Content: ${passedChecks.length}/6 AEM-specific elements found`, 
            passedChecks.length >= 3 ? 'success' : 'error'
          );
          
        } else {
          throw new Error(`HTTP ${mcpResponse.status}`);
        }
      } catch (error) {
        log(`‚ùå AEM template content verification failed: ${error.message}`, 'error');
        showResult('aem-content-result', `‚ùå AEM content verification error: ${error.message}`, 'error');
      }
    }

    // Verify Component Template Content
    async function verifyComponentTemplateContent() {
      log('üß© Verifying component template content structure...', 'info');
      
      try {
        const mcpResponse = await fetch('http://localhost:3000/', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({
            method: 'generate_template_tickets',
            params: {
              frameData: [{
                id: 'test-react-component',
                name: 'User Profile Card',
                type: 'COMPONENT',
                dimensions: { width: 320, height: 240 }
              }],
              figmaContext: {
                figmaUrl: 'https://www.figma.com/file/test/React-Components',
                fileName: 'React Design System'
              },
              platform: 'jira',
              documentType: 'component',
              teamStandards: {
                tech_stack: 'React 18 with TypeScript, Material-UI'
              }
            }
          })
        });

        if (mcpResponse.ok) {
          const result = await mcpResponse.json();
          const content = result.content?.[0]?.text || '';
          
          // Check for standard component template structure
          const componentChecks = {
            'Component Name': content.includes('User Profile Card') || content.includes('component'),
            'Acceptance Criteria': content.includes('Acceptance Criteria') || content.includes('Requirements'),
            'Technical Requirements': content.includes('Technical') || content.includes('Implementation'),
            'Testing Requirements': content.includes('Test') || content.includes('testing'),
            'Figma Link': content.includes('Figma') || content.includes('design'),
            'Estimation': content.includes('Estimation') || content.includes('hours') || content.includes('complexity')
          };

          const passedChecks = Object.entries(componentChecks).filter(([_, passed]) => passed);
          
          log(`üìã Component Template Structure Verification:`, 'info');
          Object.entries(componentChecks).forEach(([check, passed]) => {
            log(`  ${passed ? '‚úÖ' : '‚ùå'} ${check}`, passed ? 'success' : 'error');
          });
          
          showResult('component-content-result', 
            `‚úÖ Component Template Content: ${passedChecks.length}/6 standard elements found`, 
            passedChecks.length >= 4 ? 'success' : 'error'
          );
          
        } else {
          throw new Error(`HTTP ${mcpResponse.status}`);
        }
      } catch (error) {
        log(`‚ùå Component template content verification failed: ${error.message}`, 'error');
        showResult('component-content-result', `‚ùå Component content verification error: ${error.message}`, 'error');
      }
    }

    // Auto-run basic template detection test on load
    document.addEventListener('DOMContentLoaded', () => {
      log('üéØ Figma Template Selection Test Suite loaded', 'success');
      log('Ready to test AEM, React, Vue, and custom template selection logic', 'info');
      log('All tests validate that the correct template is selected based on tech stack', 'info');
      
      // Show some example template detections
      setTimeout(() => {
        log('üí° Example template detections:', 'info');
        log(`  "AEM 6.5 with HTL" ‚Üí ${determineDocumentType('AEM 6.5 with HTL')}`, 'info');
        log(`  "React 18 with TypeScript" ‚Üí ${determineDocumentType('React 18 with TypeScript')}`, 'info');
        log(`  "Vue 3 with Composition API" ‚Üí ${determineDocumentType('Vue 3 with Composition API')}`, 'info');
        log(`  "API service implementation" ‚Üí ${determineDocumentType('API service implementation')}`, 'info');
      }, 1000);
    });
  </script>
</body>
</html>