<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>Context Preview Test</title>
  <style>
    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', 'Helvetica', 'Arial', sans-serif;
      line-height: 1.5;
      background: #f8fafc;
      color: #1a202c;
      padding: 20px;
    }

    .test-container {
      max-width: 1000px;
      margin: 0 auto;
      background: white;
      border-radius: 12px;
      box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
      overflow: hidden;
    }

    .test-header {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
      padding: 24px;
      text-align: center;
    }

    .test-content {
      padding: 24px;
    }

    .test-section {
      margin-bottom: 24px;
      padding: 16px;
      background: #f8fafc;
      border-radius: 8px;
      border: 1px solid #e2e8f0;
    }

    .test-button {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
      border: none;
      padding: 12px 24px;
      border-radius: 8px;
      font-size: 14px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.2s ease;
      margin: 8px;
    }

    .test-button:hover {
      transform: translateY(-1px);
      box-shadow: 0 4px 12px rgba(102, 126, 234, 0.4);
    }

    pre {
      background: #1e293b;
      color: #e2e8f0;
      padding: 16px;
      border-radius: 8px;
      overflow-x: auto;
      font-size: 13px;
    }
  </style>
</head>

<body>
  <div class="test-container">
    <div class="test-header">
      <h1>üîç Context Preview Component Test</h1>
      <p>Testing the context preview functionality with sample data</p>
    </div>

    <div class="test-content">
      <div class="test-section">
        <h3>Test Controls</h3>
        <p>Click the buttons below to test different context scenarios:</p>
        
        <button class="test-button" onclick="testBasicContext()">
          üõ†Ô∏è Test Basic Tech Stack
        </button>
        
        <button class="test-button" onclick="testFullContext()">
          üé® Test Full Context (All Data)
        </button>
        
        <button class="test-button" onclick="testMCPContext()">
          ü§ñ Test MCP Server Context
        </button>
        
        <button class="test-button" onclick="testFigmaContext()">
          üì∏ Test Figma Selection Context
        </button>
        
        <button class="test-button" onclick="clearContext()">
          üóëÔ∏è Clear Context
        </button>
      </div>

      <!-- Context Preview Container -->
      <div id="context-preview-container"></div>

      <div class="test-section">
        <h3>Test Results</h3>
        <pre id="test-results">Ready to test context preview functionality...</pre>
      </div>
    </div>
  </div>

  <!-- Include Context Preview Component -->
  <script src="../components/context-preview.js"></script>

  <script>
    let contextPreview = null;
    let testResults = document.getElementById('test-results');

    // Initialize Context Preview
    function initializeTest() {
      contextPreview = new ContextPreview('context-preview-container', {
        showAdvancedMetrics: true,
        enableEditing: true,
        showTokenCount: true,
        collapsible: true,
        onDataChange: (data) => {
          logResult('Context data changed:', data);
        },
        onSubmit: (data) => {
          logResult('Context submitted for generation:', data);
          alert('Context would be submitted for generation!');
        }
      });
      
      logResult('Context Preview initialized successfully');
    }

    // Test Basic Tech Stack Context
    function testBasicContext() {
      const contextData = {
        techStack: {
          description: "React 18 with TypeScript, Material-UI v5, React Query for state management",
          detected: {
            frameworks: ['react'],
            languages: ['typescript'],
            tools: ['webpack'],
            testing: ['jest']
          },
          confidence: 85,
          suggestions: ['Add testing framework', 'Specify API architecture']
        }
      };
      
      contextPreview.updateContext(contextData);
      logResult('Updated with basic tech stack context');
    }

    // Test Full Context with All Data Types
    function testFullContext() {
      const contextData = {
        techStack: {
          description: "Vue 3 with Composition API, Pinia for state, Vite build tool",
          detected: {
            frameworks: ['vue'],
            languages: ['typescript'],
            tools: ['vite'],
            testing: ['vitest']
          },
          confidence: 92,
          suggestions: ['Consider adding E2E testing', 'Add deployment strategy'],
          designContext: {
            patterns: [
              { type: 'form', confidence: 85, elements: ['input fields', 'validation'] },
              { type: 'navigation', confidence: 80, elements: ['menu', 'routing'] }
            ],
            components: [
              { type: 'button', complexity: 'low', name: 'Submit Button', estimatedEffort: '30 minutes' },
              { type: 'form', complexity: 'medium', name: 'Contact Form', estimatedEffort: '2 hours' }
            ]
          }
        },
        screenshot: {
          dataUrl: 'data:image/svg+xml;base64,' + btoa(`
            <svg width="400" height="200" xmlns="http://www.w3.org/2000/svg">
              <rect width="400" height="200" fill="#f8fafc"/>
              <rect x="20" y="20" width="360" height="40" rx="8" fill="#667eea"/>
              <text x="200" y="45" text-anchor="middle" fill="white" font-family="Arial" font-size="16">Test Design</text>
              <rect x="20" y="80" width="100" height="30" rx="4" fill="#e2e8f0"/>
              <rect x="140" y="80" width="100" height="30" rx="4" fill="#e2e8f0"/>
              <rect x="260" y="80" width="120" height="30" rx="4" fill="#10b981"/>
              <text x="200" y="140" text-anchor="middle" fill="#64748b" font-family="Arial" font-size="12">Full context test</text>
            </svg>
          `),
          width: 400,
          height: 200,
          size: '2.5 KB'
        },
        mcpData: {
          tools: [
            { name: 'generate_enhanced_ticket', status: 'available' },
            { name: 'analyze_design_system', status: 'available' },
            { name: 'extract_figma_data', status: 'available' }
          ],
          status: 'connected'
        },
        designSystem: {
          colors: ['#667eea', '#764ba2', '#10b981', '#f59e0b'],
          typography: ['Inter', 'SF Pro'],
          spacing: ['4px', '8px', '16px', '24px'],
          tokensCount: 42
        },
        customContext: {
          items: [
            'Must support mobile devices',
            'Requires accessibility compliance (WCAG 2.1)',
            'Integration with existing design system'
          ]
        }
      };
      
      contextPreview.updateContext(contextData);
      logResult('Updated with full context data (all sections)');
    }

    // Test MCP Server Context
    function testMCPContext() {
      const contextData = {
        techStack: {
          description: "Next.js 13 with App Router, TailwindCSS, Prisma ORM",
          detected: {
            frameworks: ['next.js'],
            languages: ['typescript'],
            tools: ['webpack'],
            testing: []
          },
          confidence: 78,
          suggestions: ['Add testing framework', 'Include deployment strategy']
        },
        mcpData: {
          tools: [
            { name: 'generate_enhanced_ticket', status: 'available' },
            { name: 'analyze_tech_stack', status: 'available' },
            { name: 'validate_requirements', status: 'available' },
            { name: 'optimize_context', status: 'available' }
          ],
          status: 'connected',
          serverInfo: {
            version: '1.0.0',
            capabilities: ['generation', 'analysis', 'optimization']
          }
        }
      };
      
      contextPreview.updateContext(contextData);
      logResult('Updated with MCP server context');
    }

    // Test Figma Selection Context
    function testFigmaContext() {
      const contextData = {
        techStack: {
          description: "Angular 15 with NgRx, Angular Material",
          detected: {
            frameworks: ['angular'],
            languages: ['typescript'],
            tools: ['webpack'],
            testing: ['jasmine']
          },
          confidence: 88,
          suggestions: ['Add E2E testing', 'Consider PWA features'],
          designContext: {
            patterns: [
              { type: 'dataDisplay', confidence: 90, elements: ['tables', 'lists', 'filtering'] }
            ],
            components: [
              { type: 'table', complexity: 'high', name: 'Data Grid', estimatedEffort: '4-6 hours' },
              { type: 'filter', complexity: 'medium', name: 'Search Filter', estimatedEffort: '2 hours' }
            ]
          }
        },
        screenshot: {
          dataUrl: 'data:image/svg+xml;base64,' + btoa(`
            <svg width="400" height="200" xmlns="http://www.w3.org/2000/svg">
              <rect width="400" height="200" fill="#fff"/>
              <rect x="10" y="10" width="380" height="30" fill="#3f51b5"/>
              <text x="200" y="30" text-anchor="middle" fill="white" font-family="Arial" font-size="14">Figma Selection</text>
              <rect x="10" y="50" width="100" height="20" fill="#e0e0e0"/>
              <rect x="120" y="50" width="100" height="20" fill="#e0e0e0"/>
              <rect x="230" y="50" width="100" height="20" fill="#e0e0e0"/>
              <rect x="340" y="50" width="50" height="20" fill="#4caf50"/>
              <text x="200" y="100" text-anchor="middle" fill="#666" font-family="Arial" font-size="12">Selected: Data Table Component</text>
              <text x="200" y="120" text-anchor="middle" fill="#999" font-family="Arial" font-size="10">From Figma file: Dashboard.fig</text>
            </svg>
          `),
          width: 400,
          height: 200,
          size: '2.1 KB'
        },
        figmaContext: {
          fileKey: 'test-file-key-123',
          fileName: 'Dashboard Design System',
          selection: [
            { id: '1', name: 'Data Table', type: 'FRAME' },
            { id: '2', name: 'Filter Controls', type: 'FRAME' },
            { id: '3', name: 'Action Buttons', type: 'FRAME' }
          ],
          hasSelection: true,
          selectionCount: 3
        }
      };
      
      contextPreview.updateContext(contextData);
      logResult('Updated with Figma selection context');
    }

    // Clear Context
    function clearContext() {
      contextPreview.updateContext(null);
      logResult('Context cleared');
    }

    // Log test results
    function logResult(message, data = null) {
      const timestamp = new Date().toLocaleTimeString();
      let logEntry = `[${timestamp}] ${message}`;
      
      if (data) {
        logEntry += '\n' + JSON.stringify(data, null, 2);
      }
      
      testResults.textContent = logEntry + '\n\n' + testResults.textContent;
    }

    // Initialize on page load
    document.addEventListener('DOMContentLoaded', () => {
      initializeTest();
    });
  </script>
</body>
</html>