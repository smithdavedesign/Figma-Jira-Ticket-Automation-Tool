openapi: 3.0.3
info:
  title: Figma AI Ticket Generator API
  description: |
    üéØ **Unified Documentation Generation API**
    
    Generate JIRA tickets, Wiki pages, Code documentation, and more from Figma designs using AI.
    
    ## üöÄ **Key Features:**
    - **Unified Generation**: Single endpoint for all documentation formats
    - **Multiple Strategies**: AI, Template, Enhanced, Legacy, Auto-detection
    - **Format Support**: JIRA (active), Wiki/Code/Markdown (planned)
    - **Smart Auto-Detection**: Automatically selects best strategy based on input
    - **Legacy Compatibility**: Backward compatible with deprecation warnings
    
    ## üéØ **Primary Endpoint:**
    Use `POST /api/generate` for all documentation generation needs.
    
    ## üìã **Migration Guide:**
    - `POST /api/generate-ticket` ‚Üí `POST /api/generate` with `format: "jira"` and `strategy: "template"`
    - `POST /api/generate-ai-ticket-direct` ‚Üí `POST /api/generate` with `format: "jira"` and `strategy: "ai"`
    
  version: 2.0.0
  contact:
    name: Figma AI Support
    url: https://github.com/figma-ai/ticket-generator
  license:
    name: MIT
    url: https://opensource.org/licenses/MIT

servers:
  - url: http://localhost:3000
    description: Development Server
  - url: https://api.figma-ai.com
    description: Production Server

tags:
  - name: generate
    description: üéØ Unified documentation generation
  - name: health
    description: üè• System health and monitoring
  - name: figma
    description: üé® Figma integration and screenshots
  - name: mcp
    description: üîå Figma Design Context MCP Server (No Ticket Generation)
  - name: api
    description: üì° Core API endpoints (legacy)
  - name: test
    description: üß™ Testing and validation
  - name: live
    description: üì° Live data and real-time features

paths:
  /api/generate:
    post:
      tags: [generate]
      summary: üéØ Generate Documentation (Unified Endpoint)
      description: |
        **Primary endpoint for all documentation generation needs.**
        
        Supports multiple formats (JIRA, Wiki, Code, Markdown) and strategies (AI, Template, Enhanced, Legacy, Auto).
        
        ### üß† Auto-Strategy Detection:
        - **Rich data** (10+ frames + screenshot) ‚Üí AI strategy
        - **Medium data** (5+ frames) ‚Üí Enhanced strategy  
        - **Basic data** (1+ frames) ‚Üí Template strategy
        - **Minimal data** ‚Üí Legacy strategy
        
        ### üìù Format Support:
        - `jira` - JIRA tickets (‚úÖ Active)
        - `wiki` - Wiki pages (üîú Planned)
        - `code` - Code documentation (üîú Planned)
        - `markdown` - Markdown files (üîú Planned)
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/GenerateRequest'
            examples:
              jira_ai:
                summary: JIRA Ticket with AI Strategy (Test Mode)
                value:
                  frameData:
                    - type: "button"
                      content: "Login Button"
                      properties: { color: "primary", size: "large" }
                    - type: "input" 
                      content: "Email Field"
                      properties: { type: "email", required: true }
                  format: "jira"
                  strategy: "ai"
                  documentType: "story"
                  techStack: "React, TypeScript"
                  includeScreenshot: true
                  mockMode: true
              auto_detect:
                summary: Auto-Strategy Detection (Test Mode)
                value:
                  frameData:
                    - type: "text"
                      content: "Dashboard Header"
                    - type: "button"
                      content: "Export"
                    - type: "table"
                      content: "Data Grid"
                  format: "jira"
                  strategy: "auto"
                  documentType: "task"
                  mockMode: true
              simple_test:
                summary: Simple Test (Minimal Data)
                value:
                  strategy: "enhanced"
                  documentType: "task"
                  mockMode: true
              wiki_planned:
                summary: Wiki Generation (Planned)
                value:
                  frameData:
                    - type: "text"
                      content: "Component Documentation"
                  format: "wiki"
                  strategy: "template"
                  documentType: "documentation"
                  mockMode: true
      responses:
        '200':
          description: Documentation generated successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/GenerateResponse'
              examples:
                success:
                  summary: Successful Generation
                  value:
                    success: true
                    message: "Documentation generated successfully"
                    data:
                      content: "# Login Component\n\n## Description\nImplement login button with email validation..."
                      format: "jira"
                      strategy: "ai"
                      confidence: 0.95
                      performance:
                        duration: 1250
                        cacheHit: false
                      generatedAt: "2025-10-31T12:00:00.000Z"
        '400':
          $ref: '#/components/responses/ValidationError'
        '500':
          $ref: '#/components/responses/ServerError'

  /api/generate-ticket:
    post:
      tags: [api]
      summary: üìã Generate JIRA Ticket (Legacy - Deprecated)
      deprecated: true
      description: |
        **‚ö†Ô∏è DEPRECATED**: Use `/api/generate` instead.
        
        Legacy endpoint for JIRA ticket generation using template strategy.
        This endpoint adds deprecation headers and redirects to the unified endpoint.
      parameters:
        - name: X-Deprecated
          in: header
          schema:
            type: string
            example: "true"
          description: Deprecation warning header
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/LegacyTicketRequest'
      responses:
        '200':
          description: Ticket generated (via unified endpoint)
          headers:
            X-Deprecated:
              description: Deprecation warning
              schema:
                type: string
                example: "true"
            X-Deprecation-Message:
              description: Migration message
              schema:
                type: string
                example: "Use /api/generate instead"
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/GenerateResponse'

  /api/generate-ai-ticket-direct:
    post:
      tags: [api]
      summary: ü§ñ Generate AI Ticket Direct (Legacy - Deprecated)
      deprecated: true
      description: |
        **‚ö†Ô∏è DEPRECATED**: Use `/api/generate` with `strategy: "ai"` instead.
        
        Legacy endpoint for direct AI ticket generation.
        This endpoint adds deprecation headers and redirects to the unified endpoint.
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/LegacyAIRequest'
      responses:
        '200':
          description: AI ticket generated (via unified endpoint)
          headers:
            X-Deprecated:
              description: Deprecation warning
              schema:
                type: string
                example: "true"
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/GenerateResponse'

  /:
    get:
      tags: [health]
      summary: üè• System Health Check
      description: Get comprehensive system health status
      responses:
        '200':
          description: System is healthy
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/HealthResponse'

  /api/figma/screenshot:
    post:
      tags: [figma]
      summary: üì∏ Enhanced Figma Screenshot with Context Layer
      description: |
        **Enhanced Figma screenshot capture with Context Layer integration.**
        
        New architecture: `Figma API ‚Üí Context Layer ‚Üí Semantic Analysis ‚Üí Structured Output`
        
        ### üÜï Context Layer Features:
        - **Design Token Extraction**: Automatic colors, typography, spacing analysis
        - **Component Mapping**: Recognition of reusable UI patterns  
        - **Layout Intelligence**: Grid systems and alignment pattern detection
        - **Semantic Relationships**: Component hierarchy understanding
        - **Accessibility Analysis**: WCAG compliance checking
        
        ### üìä Enhanced Response:
        - Screenshot data (base64)
        - Context Layer semantic analysis
        - Legacy visual analysis (supplementary)
        - Performance metrics and caching
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [figmaUrl]
              properties:
                figmaUrl:
                  type: string
                  format: uri
                  description: Figma file URL
                  example: "https://www.figma.com/file/ABC123/Design-System"
                includeAnalysis:
                  type: boolean
                  default: false
                  description: Include Context Layer + legacy analysis
                testMode:
                  type: boolean
                  default: false
                  description: Use test screenshot instead of real capture
                format:
                  type: string
                  enum: [base64, buffer]
                  default: base64
                  description: Screenshot format
                quality:
                  type: string
                  enum: [low, medium, high]
                  default: high
                  description: Screenshot quality
            examples:
              enhanced_capture:
                summary: Enhanced Screenshot with Context Analysis
                value:
                  figmaUrl: "https://www.figma.com/file/ABC123/Design-System"
                  includeAnalysis: true
                  format: "base64"
                  quality: "high"
              test_mode:
                summary: Test Mode (Development)
                value:
                  testMode: true
                  includeAnalysis: true
      responses:
        '200':
          description: Enhanced screenshot captured successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                  message:
                    type: string
                  data:
                    type: object
                    properties:
                      screenshot:
                        type: object
                        properties:
                          data:
                            type: string
                            format: base64
                          format:
                            type: string
                          size:
                            type: integer
                          quality:
                            type: string
                      contextAnalysis:
                        type: object
                        nullable: true
                        properties:
                          designTokens:
                            type: object
                            properties:
                              colors:
                                type: array
                              spacing:
                                type: array
                          components:
                            type: array
                          layoutPatterns:
                            type: array
                          styleSystem:
                            type: object
                          accessibility:
                            type: object
                          semantic:
                            type: object
                          confidence:
                            type: number
                            minimum: 0
                            maximum: 1
                          processingPipeline:
                            type: string
                            example: "figma-api ‚Üí context-layer ‚Üí semantic-analysis"
                      legacyAnalysis:
                        type: object
                        nullable: true
                        description: Supplementary visual analysis
                      metadata:
                        type: object
                        properties:
                          timestamp:
                            type: string
                            format: date-time
                          processingTime:
                            type: integer
                          testMode:
                            type: boolean
                          contextLayerEnabled:
                            type: boolean
                          architecture:
                            type: string
                            example: "enhanced-context-integration"
        '400':
          $ref: '#/components/responses/ValidationError'
        '403':
          description: Cannot access Figma file - check permissions
        '408':
          description: Screenshot capture timed out
        '500':
          $ref: '#/components/responses/ServerError'

  /api/figma/extract-context:
    post:
      tags: [figma]
      summary: üé® Extract Context from Figma (NEW)
      description: |
        **NEW**: Direct Context Layer endpoint for semantic design analysis.
        
        Extract design intelligence without screenshot overhead. Perfect for when you need design tokens, component analysis, and semantic understanding but not visual capture.
        
        ### üß† Context Extraction Features:
        - Design system analysis
        - Component relationship mapping  
        - Layout pattern recognition
        - Accessibility compliance checking
        - Semantic component classification
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [figmaUrl]
              properties:
                figmaUrl:
                  type: string
                  format: uri
                  description: Figma file URL
                frameData:
                  type: array
                  description: Optional frame data for focused analysis
                  items:
                    type: object
                options:
                  type: object
                  description: Context extraction options
                  properties:
                    includeDesignTokens:
                      type: boolean
                      default: true
                    includeComponents:
                      type: boolean  
                      default: true
                    includeAccessibility:
                      type: boolean
                      default: true
            examples:
              full_extraction:
                summary: Full Context Extraction
                value:
                  figmaUrl: "https://www.figma.com/file/ABC123/Design-System"
                  options:
                    includeDesignTokens: true
                    includeComponents: true
                    includeAccessibility: true
      responses:
        '200':
          description: Context extraction completed successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                  data:
                    type: object
                    properties:
                      context:
                        $ref: '#/components/schemas/ContextAnalysis'
                      source:
                        type: string
                        example: "context-layer"
                      figmaUrl:
                        type: string
                      architecture:
                        type: string
                        example: "figma-api ‚Üí context-layer ‚Üí semantic-analysis"
                      metadata:
                        type: object
                        properties:
                          timestamp:
                            type: string
                            format: date-time
                          processingTime:
                            type: integer
                          contextVersion:
                            type: string
                          extractorCount:
                            type: integer
        '503':
          description: Context Layer unavailable

  /api/figma/enhanced-capture:
    post:
      tags: [figma]
      summary: üöÄ Enhanced Capture - Screenshot + Context + AI (NEW)
      description: |
        **NEW**: Complete parallel processing endpoint combining screenshot capture, Context Layer analysis, and optional visual AI.
        
        ### üîÑ Parallel Processing Features:
        - Screenshot capture (configurable)
        - Context Layer semantic analysis (configurable) 
        - Visual AI analysis (optional)
        - Optimized performance through parallel execution
        
        ### üìä Use Cases:
        - Complete design analysis pipeline
        - Performance-optimized data gathering
        - Configurable analysis components
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [figmaUrl]
              properties:
                figmaUrl:
                  type: string
                  format: uri
                frameData:
                  type: array
                  items:
                    type: object
                format:
                  type: string
                  enum: [base64, buffer]
                  default: base64
                quality:
                  type: string
                  enum: [low, medium, high]
                  default: high
                includeScreenshot:
                  type: boolean
                  default: true
                includeContext:
                  type: boolean
                  default: true
                includeVisualAI:
                  type: boolean
                  default: false
                options:
                  type: object
            examples:
              full_analysis:
                summary: Complete Analysis Pipeline
                value:
                  figmaUrl: "https://www.figma.com/file/ABC123/Design-System"
                  includeScreenshot: true
                  includeContext: true
                  includeVisualAI: true
              context_only:
                summary: Context Analysis Only (Fast)
                value:
                  figmaUrl: "https://www.figma.com/file/ABC123/Design-System"
                  includeScreenshot: false
                  includeContext: true
                  includeVisualAI: false
      responses:
        '200':
          description: Enhanced capture completed successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                  data:
                    type: object
                    properties:
                      screenshot:
                        type: object
                        nullable: true
                      contextAnalysis:
                        $ref: '#/components/schemas/ContextAnalysis'
                        nullable: true
                      visualAnalysis:
                        type: object
                        nullable: true
                      source:
                        type: string
                        example: "enhanced-capture"
                      architecture:
                        type: string
                        example: "parallel-processing ‚Üí context-layer + screenshot + visual-ai"
                      metadata:
                        type: object
                        properties:
                          timestamp:
                            type: string
                            format: date-time
                          processingTime:
                            type: integer
                          includeScreenshot:
                            type: boolean
                          includeContext:
                            type: boolean
                          includeVisualAI:
                            type: boolean
                          parallelProcessing:
                            type: boolean

  /mcp/status:
    get:
      tags: [mcp]
      summary: üîå Figma Design Context MCP Status
      description: Get Figma Design Context MCP server status (design context only, no ticket generation)
      responses:
        '200':
          description: MCP status retrieved
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                  data:
                    type: object
                    properties:
                      status:
                        type: string
                        enum: [healthy, degraded, unhealthy]
                      services:
                        type: object
                      tools:
                        type: array

  /mcp/tools:
    get:
      tags: [mcp]
      summary: üõ†Ô∏è List Figma Design Context Tools
      description: Get available MCP tools for Figma design context extraction (capture_figma_screenshot, extract_figma_context, get_figma_design_tokens)
      responses:
        '200':
          description: MCP tools listed
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                  data:
                    type: object
                    properties:
                      tools:
                        type: array
                        items:
                          type: object
                          properties:
                            name:
                              type: string
                            description:
                              type: string
                            inputSchema:
                              type: object

  /test/ai-ticket-generation:
    post:
      tags: [test]
      summary: üß™ Test AI Ticket Generation
      description: Test ticket generation with various scenarios
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                scenario:
                  type: string
                  enum: [simple, complex, minimal, rich]
                strategy:
                  type: string
                  enum: [ai, template, enhanced, legacy]
                includeScreenshot:
                  type: boolean
      responses:
        '200':
          description: Test completed
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                  data:
                    type: object
                    properties:
                      scenario:
                        type: string
                      strategy:
                        type: string
                      performance:
                        type: object

components:
  schemas:
    GenerateRequest:
      type: object
      required: [strategy]
      properties:
        frameData:
          type: array
          description: Design frame data from Figma
          items:
            type: object
            properties:
              type:
                type: string
                enum: [text, button, input, select, checkbox, link, image, component]
              content:
                type: string
              properties:
                type: object
                additionalProperties: true
          minItems: 1
        format:
          type: string
          enum: [jira, wiki, code, markdown]
          default: jira
          description: Output format for generated documentation
        strategy:
          type: string
          enum: [ai, template, enhanced, legacy, auto]
          default: auto
          description: Generation strategy (auto selects best based on input)
        documentType:
          type: string
          enum: [story, task, bug, epic, documentation, component]
          default: task
          description: Type of documentation to generate
        figmaUrl:
          type: string
          format: uri
          description: Optional Figma URL for additional context
        screenshot:
          type: string
          format: base64
          description: Optional screenshot data
        techStack:
          type: string
          description: Technology stack for context
        teamStandards:
          type: object
          description: Team-specific standards and guidelines
        projectName:
          type: string
          description: Project name for context
        includeScreenshot:
          type: boolean
          default: false
          description: Whether to include screenshot analysis
        mockMode:
          type: boolean
          default: true
          description: Enable mock responses for testing
    GenerateResponse:
      type: object
      properties:
        success:
          type: boolean
        message:
          type: string
        data:
          type: object
          properties:
            content:
              type: string
              description: Generated documentation content
            format:
              type: string
              description: Output format used
            strategy:
              type: string
              description: Strategy used for generation
            confidence:
              type: number
              minimum: 0
              maximum: 1
              description: Confidence score of generation
            performance:
              type: object
              properties:
                duration:
                  type: integer
                  description: Generation time in milliseconds
                cacheHit:
                  type: boolean
                  description: Whether result came from cache
            metadata:
              type: object
              description: Additional metadata
            generatedAt:
              type: string
              format: date-time
              description: Generation timestamp

    LegacyTicketRequest:
      type: object
      required: [frameData, platform, documentType]
      properties:
        frameData:
          type: array
          items:
            type: object
        platform:
          type: string
          enum: [jira]
        documentType:
          type: string
        teamStandards:
          type: object

    LegacyAIRequest:
      type: object
      required: [enhancedFrameData]
      properties:
        enhancedFrameData:
          type: array
          items:
            type: object
        useAI:
          type: boolean
          default: true
        platform:
          type: string
        documentType:
          type: string
        techStack:
          type: string

    HealthResponse:
      type: object
      properties:
        status:
          type: string
          enum: [healthy, degraded, unhealthy]
        timestamp:
          type: string
          format: date-time
        version:
          type: string
        server:
          type: string
        architecture:
          type: string
        phase:
          type: string
        uptime:
          type: number
        memory:
          type: object
          properties:
            rss:
              type: integer
            heapTotal:
              type: integer
            heapUsed:
              type: integer
        environment:
          type: object
          properties:
            node:
              type: string
            platform:
              type: string
            arch:
              type: string
        services:
          type: object
          additionalProperties:
            type: boolean

    ContextAnalysis:
      type: object
      description: Context Layer semantic analysis results
      properties:
        designTokens:
          type: object
          description: Extracted design tokens
          properties:
            colors:
              type: array
              items:
                type: object
                properties:
                  name:
                    type: string
                  value:
                    type: string
                  usage:
                    type: string
            spacing:
              type: array
              items:
                type: object
                properties:
                  name:
                    type: string
                  value:
                    type: string
                  unit:
                    type: string
            typography:
              type: array
              items:
                type: object
                properties:
                  name:
                    type: string
                  fontSize:
                    type: number
                  fontFamily:
                    type: string
                  fontWeight:
                    type: string
        components:
          type: array
          description: Identified UI components
          items:
            type: object
            properties:
              id:
                type: string
              name:
                type: string
              type:
                type: string
                enum: [button, input, text, card, navigation, form, modal, list]
              properties:
                type: object
              relationships:
                type: array
                items:
                  type: string
        layoutPatterns:
          type: array
          description: Detected layout patterns
          items:
            type: object
            properties:
              type:
                type: string
                enum: [grid, flexbox, stack, sidebar, header, footer]
              properties:
                type: object
              elements:
                type: array
                items:
                  type: string
        styleSystem:
          type: object
          description: Design system analysis
          properties:
            consistency:
              type: number
              minimum: 0
              maximum: 1
            patterns:
              type: array
              items:
                type: string
            violations:
              type: array
              items:
                type: object
                properties:
                  type:
                    type: string
                  description:
                    type: string
                  severity:
                    type: string
                    enum: [low, medium, high, critical]
        accessibility:
          type: object
          description: Accessibility analysis
          properties:
            score:
              type: number
              minimum: 0
              maximum: 100
            issues:
              type: array
              items:
                type: object
                properties:
                  type:
                    type: string
                  description:
                    type: string
                  impact:
                    type: string
                    enum: [low, medium, high, critical]
                  wcagLevel:
                    type: string
                    enum: [A, AA, AAA]
            recommendations:
              type: array
              items:
                type: string
        semantic:
          type: object
          description: Semantic understanding
          properties:
            purpose:
              type: string
              description: Inferred component/screen purpose
            userFlow:
              type: array
              description: Detected user flow steps
              items:
                type: object
                properties:
                  step:
                    type: integer
                  action:
                    type: string
                  component:
                    type: string
            interactions:
              type: array
              description: Interactive elements and behaviors
              items:
                type: object
                properties:
                  element:
                    type: string
                  interaction:
                    type: string
                  outcome:
                    type: string
        confidence:
          type: number
          minimum: 0
          maximum: 1
          description: Overall confidence score of the analysis
        extraction:
          type: object
          description: Extraction metadata
          properties:
            extractors:
              type: array
              items:
                type: string
            processingTime:
              type: integer
            version:
              type: string
            architecture:
              type: string

    ErrorResponse:
      type: object
      properties:
        success:
          type: boolean
          example: false
        error:
          type: string
        message:
          type: string
        context:
          type: object
        timestamp:
          type: string
          format: date-time

  responses:
    ValidationError:
      description: Request validation failed
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/ErrorResponse'
          example:
            success: false
            error: "Validation failed"
            message: "Invalid input data"
            context:
              errors:
                - "frameData is required"
                - "format must be one of: jira, wiki, code, markdown"

    ServerError:
      description: Internal server error
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/ErrorResponse'
          example:
            success: false
            error: "Internal server error"
            message: "Generation failed"
            context:
              service: "TicketGenerationService"
              operation: "generateTicket"

  securitySchemes:
    ApiKeyAuth:
      type: apiKey
      in: header
      name: X-API-Key
      description: API key for authentication (when enabled)

security:
  - {} # No security required for development
  # - ApiKeyAuth: [] # Uncomment for production

externalDocs:
  description: Full Documentation
  url: https://docs.figma-ai.com/api