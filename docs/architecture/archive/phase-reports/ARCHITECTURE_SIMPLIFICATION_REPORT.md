# ğŸ§¹ Architecture Simplification Report - October 30, 2025

## ğŸ¯ **Problem Identified**

The project had significant structural redundancy due to evolution from simple plugin to MVC architecture:

### **Before Simplification:**
```
âŒ REDUNDANT STRUCTURE:
â”œâ”€â”€ ğŸ“„ manifest.json (root)           â†’ Points to: code.js + ui/index.html
â”œâ”€â”€ ğŸ“„ code.ts (1,230 lines)          â†’ TypeScript source (in root)
â”œâ”€â”€ ğŸ“„ code.js (1,109 lines)          â†’ Compiled output (in root)
â”œâ”€â”€ ğŸ“ production-bundle/
â”‚   â”œâ”€â”€ manifest.json                 â†’ Points to: 
â”‚   â”œâ”€â”€ code.js                       â†’ Triplicate build output
â”‚   â””â”€â”€ ui/                           â†’ Triplicate UI files
â””â”€â”€ ğŸ“ app/main.js                    â†’ MCP Server (separate system)
```

### **Issues:**
- **3 identical Figma plugin manifests** with different paths
- **3 copies of compiled code.js** in different locations
- **TypeScript source mixed with build outputs** in root directory
- **Confusion between MCP server** (app/main.js) **and Figma plugin** (code.js)
- **Build artifacts committed to git** instead of being generated

## âœ… **Simplified Architecture**

### **After Simplification:**
```
âœ… CLEAN STRUCTURE:
â”œâ”€â”€ ğŸ“„ manifest.json                  # Single manifest for Figma Desktop
â”œâ”€â”€ ğŸ“„ code.js                        # Compiled plugin (generated by build)
â”œâ”€â”€ ğŸ“ src/
â”‚   â””â”€â”€ code.ts                       # TypeScript source (moved here)
â”œâ”€â”€ ğŸ“ ui/index.html                  # Plugin UI (single source)
â”œâ”€â”€ ğŸ“ app/main.js                    # MCP Server (separate system - localhost:3000)
â””â”€â”€ ğŸ“ config/tsconfig.json           # Points to src/code.ts

ğŸ“ BUILD OUTPUTS (Generated, not committed):
â”œâ”€â”€ ğŸ“ dist/                          # TypeScript compilation artifacts
â””â”€â”€ ğŸ“ production-bundle/             # Distribution package (generated on demand)
```

### **Benefits:**
- **Single source of truth** for each component
- **Clear separation** between MCP server and Figma plugin
- **Build artifacts excluded** from version control
- **TypeScript source properly organized** in src/ directory
- **Simplified build process** with build-simple.sh as primary

## ğŸ”§ **Changes Made**

### **1. File Organization**
- **Moved**: `code.ts` â†’ `src/code.ts` (source code organization)
- **Updated**: `config/tsconfig.json` to point to `src/code.ts`
- **Removed**: `dist/` and `production-bundle/` (regenerated by build)
- **Removed**: `playwright-report/` from root (reports now go to `tests/test-results/`)
- **Updated**: `.gitignore` to exclude build artifacts

### **2. Build Process Simplification**
- **Primary Build**: `npm run build` â†’ `./scripts/build-simple.sh`
- **Single Manifest**: Root `manifest.json` points to `code.js` + `ui/index.html`
- **Clean Outputs**: Build generates only what's needed for Figma Desktop

### **3. Clear System Separation**
```
ğŸ¯ TWO SEPARATE SYSTEMS:

1. ğŸ“± FIGMA PLUGIN:
   â”œâ”€â”€ src/code.ts                    # Source code  
   â”œâ”€â”€ code.js                        # Compiled plugin logic (TypeScript â†’ JavaScript)
   â”œâ”€â”€ ui/index.html                  # Plugin UI (runs in Figma iframe)
   â””â”€â”€ manifest.json                  # Figma plugin configuration

2. ğŸŒ MCP SERVER:
   â”œâ”€â”€ app/main.js                    # Express server entry point (localhost:3000)
   â”œâ”€â”€ core/                          # Business logic models
   â””â”€â”€ config/                        # Server configuration

3. ğŸ§ª TEST INFRASTRUCTURE:
   â”œâ”€â”€ tests/test-results/            # All test artifacts organized here
   â”œâ”€â”€ tests/test-results/playwright-reports/  # Playwright HTML reports
   â””â”€â”€ tests/test-results/playwright-screenshots/  # Test screenshots
```

## ğŸš€ **Usage Instructions**

### **For Development:**
```bash
# Start MCP Server (separate system)
npm run start:dev                     # Runs app/main.js on localhost:3000

# Build Figma Plugin
npm run build                         # Compiles src/code.ts â†’ code.js

# Test Plugin
# Import manifest.json into Figma Desktop
```

### **For Production:**
```bash
# Create distribution package
npm run bundle                        # Generates production-bundle/

# Deploy MCP Server
npm run deploy:prod                   # Deploys server infrastructure

# Figma Plugin Distribution
# Use manifest.json + code.js + ui/ for Figma Plugin Store
```

## ğŸ“Š **Results**

### **File Reduction:**
- **Before**: 3 manifest files, 3 code.js copies, mixed source/build files
- **After**: 1 manifest file, 1 source file, generated build outputs

### **Clarity Achieved:**
- âœ… **TypeScript source** clearly separated in `src/`
- âœ… **Build outputs** excluded from version control
- âœ… **MCP server** vs **Figma plugin** distinction clear
- âœ… **Single build command** for development workflow

### **Maintained Functionality:**
- âœ… **All tests passing** after simplification
- âœ… **MCP server** continues running on localhost:3000  
- âœ… **Figma plugin** builds and works correctly
- âœ… **Production bundling** regenerates distribution packages

## ğŸ¯ **Architecture Clarity**

The project now has **two distinct systems** that work together:

### **1. Figma Plugin** (Frontend)
- **Purpose**: Runs inside Figma Desktop application
- **Technology**: TypeScript compiled to JavaScript for Figma runtime
- **Files**: `src/code.ts` â†’ `code.js` + `ui/index.html` + `manifest.json`
- **Communication**: HTTP requests to MCP server

### **2. MCP Server** (Backend)  
- **Purpose**: Provides AI services and business logic
- **Technology**: Node.js with Express framework
- **Files**: `app/main.js` + `core/` directory + `config/`
- **Network**: Runs on localhost:3000, serves HTTP API

This separation provides:
- **Scalability**: Server can handle multiple plugin instances
- **Security**: AI keys and logic secured on server side
- **Maintainability**: Clear boundaries between frontend and backend
- **Testability**: Each system can be tested independently

---

**Status**: âœ… **Architecture Simplification Complete**  
**Next**: Continue with team parameter testing and live Figma validation