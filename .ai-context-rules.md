# ü§ñ AI Assistant Context Rules

## üö® **CRITICAL DOCUMENTATION RULE**

**ALL documentation files (.md, README, guides, instructions) MUST be placed in the `docs/` directory.**

## ‚ö° **USER ENFORCEMENT COMMANDS**

**If AI doesn't read context rules first, say:**
- `"Read context rules first!"`
- `"Follow .ai-context-rules.md protocol!"`
- `"Check session start protocol!"`
- `"Stop! Read MASTER_PROJECT_CONTEXT.md first!"`

## üß† **MANDATORY SESSION STARTUP RULE**

### üö® **CRITICAL: SESSION START PROTOCOL**
**AI ASSISTANT MUST SAY:** "I'm reading the context rules first..." then actually read them!

**USER ENFORCEMENT:** If I don't mention reading context rules in my first response, please say:
- "Read the context rules first!"
- "Follow the .ai-context-rules.md protocol!"
- "Check MASTER_PROJECT_CONTEXT.md before proceeding!"

### ‚ö° **ESSENTIAL DOCUMENTATION REVIEW - ALWAYS READ FIRST:**

#### **üéØ CORE PROJECT UNDERSTANDING (MANDATORY)**
1. **`docs/MASTER_PROJECT_CONTEXT.md`** - Complete project context and current status
2. **`docs/MASTER_FUTURE_PLAN.md`** - Strategic roadmap and next phases (Phases 7-10)
3. **`docs/architecture/MCP_ARCHITECTURE.md`** - MCP server integration (NEVER implement direct Figma API)
4. **`docs/project-phases/PHASE_6_TEMPLATE_SYSTEM_COMPLETE.md`** - Current phase completion status

#### **üîß TECHNICAL IMPLEMENTATION (REQUIRED)**
5. **`docs/api/MCP_API_REFERENCE.md`** - MCP server endpoints and data structures
6. **`docs/implementation/TEMPLATE_SYSTEM_CONFIG.md`** - Template system architecture
7. **`docs/deployment/PRODUCTION_DEPLOYMENT.md`** - Production deployment status and process
8. **`docs/testing/COMPREHENSIVE_TEST_STRATEGY.md`** - Testing approach and validation

#### **üé® DESIGN INTELLIGENCE FOCUS (KEY DIFFERENTIATOR)**
9. **`docs/guides/DESIGN_INTELLIGENCE_VISION.md`** - AI-powered design analysis capabilities
10. **`docs/implementation/AI_ORCHESTRATION_GUIDE.md`** - Multi-modal AI integration patterns

#### **üìã QUICK REFERENCE (AS NEEDED)**
- **`docs/troubleshooting/COMMON_ISSUES.md`** - Known issues and solutions
- **`docs/guides/PLUGIN_SETUP_GUIDE.md`** - Setup and configuration
- **`docs/testing/LIVE_TESTING_GUIDE.md`** - Live Figma integration testing
- **`docs/api/FIGMA_API_INTEGRATION.md`** - Figma API usage patterns via MCP

### **üéØ STARTUP CHECKLIST:**
**Before ANY work on this project:**
- [ ] Read MASTER_PROJECT_CONTEXT.md (current status)
- [ ] Read MASTER_FUTURE_PLAN.md (strategic direction) 
- [ ] Understand MCP architecture (no direct Figma API)
- [ ] Check Phase 6 completion status
- [ ] Review template system configuration
- [ ] Understand design intelligence capabilities

### **üìä PROJECT STATUS CONTEXT:**
- **Current Phase**: Phase 6 Complete (Advanced Template System)
- **Next Focus**: Phase 7 (Live Figma Integration) 
- **Key Differentiator**: Design Intelligence (AI-powered design analysis)
- **Architecture**: MCP Server + Plugin UI (localhost:3000)
- **Production Status**: Ready for enterprise deployment

### **MANDATORY UPDATE RULE:**
**ALWAYS update `docs/MASTER_PROJECT_CONTEXT.md` after:**
- Major architectural changes
- Phase completions or milestones  
- Git pushes with significant changes
- Architecture decisions or clarifications
- AI service updates (API keys, service availability)

## ‚úÖ **AI INTEGRATION DATA LAYER CONSOLE STATUS**

### **üéØ WORKING COMPONENTS (Verified October 16, 2025)**
- ‚úÖ **MCP Server Pipeline**: Full data layer processing
- ‚úÖ **Enhanced Data Validation**: Schema validation passing
- ‚úÖ **AI Integration Console**: Real-time service status monitoring
- ‚úÖ **Fallback System**: Graceful degradation when AI unavailable
- ‚úÖ **Data Flow Visibility**: Complete pipeline transparency
- ‚úÖ **Professional Output**: High-quality ticket generation

### **üîç AI CONSOLE OUTPUT ANALYSIS**
```
ü§ñ Starting AI-enhanced ticket generation...
üìã Document type: jira
üîÆ AI enabled: true  
üß† AI Services Status: { gemini: false, geminiVision: false, ... }
‚ö†Ô∏è No AI services available, falling back to standard generation
üé´ Generating enhanced tickets for: 0 frames
ü§ù Figma MCP integration: enabled
‚úÖ AI ticket generation successful
```

### **üéØ DATA LAYER CONTEXT CONFIRMED**
The system successfully processes:
- **Enhanced Frame Data**: Component specs, dimensions, colors
- **Screenshot Data**: Base64 encoded images  
- **Tech Stack Context**: Framework and library information
- **Document Type**: Design system classification
- **Template Context**: File and page metadata
- **Accessibility Data**: WCAG compliance information
- **Typography & Spacing**: Complete design token extraction

## üöÄ **VITAL STARTUP SCRIPTS & RUN MODES**

### **üéØ CRITICAL MCP SERVER COMMANDS**
```bash
#### **MCP Server (CRITICAL - Always Start First)**
```bash
# Primary startup method (MVC ARCHITECTURE)
npm run start:mvc                 # Start app/server/main.js (RECOMMENDED)

# Alternative methods
npm run start:dev                 # Development mode with file watching
npm start                         # Direct server startup
node app/server/main.js           # Direct node execution

# Health check (ALWAYS VERIFY)
curl -s http://localhost:3000/ --max-time 3
lsof -i :3000  # Check if port is in use
```
```

### **üîß PLUGIN BUILD & TESTING COMMANDS**
```bash
# Build Plugin for Figma (ESSENTIAL)
npm run build:ts                      # TypeScript compilation
./scripts/build.sh                    # Development build
./scripts/bundle-production.sh        # Production bundle

# Quick Development Cycle
npm run build:ts && npm run test:integration:mcp && npm run health
```

### **üß™ TESTING COMMAND ARSENAL**

#### **MCP Integration Testing (PRIMARY)**
```bash
# Core MCP data layer testing (ESSENTIAL)
npm run test:integration:mcp          # Standalone MCP testing
npm run test:integration              # All integration tests

# MCP Server direct testing
curl -X POST http://localhost:3000/ \
  -H "Content-Type: application/json" \
  -d '{"method":"generate_ai_ticket","params":{"enhancedFrameData":[...]}}'
```

#### **System Health & Validation**
```bash
npm run health                        # System health (no servers needed)
npm run health:start                  # Health + auto-start servers
npm run validate:quick                # Complete validation (~3 min)
```

#### **Browser & UI Testing**
```bash
npm run test:browser:smoke           # Essential UI tests (~2 min)
npm run test:browser:quick           # Single UI test (~30s)  
npm run test:browser                 # Full cross-browser (~10 min)
npm run test:browser:headed          # Visual debugging
```

#### **Unit & Performance Testing**
```bash
npm run test:unit                    # Core logic tests (2s)
npm run test:performance             # Performance benchmarks
npm run test:all:quick              # Quick validation suite
```

### **üìä PROJECT STATUS COMMANDS**
```bash
# Check all systems
npm run health && curl -s http://localhost:3000/ && echo "‚úÖ MCP Ready"

# Build verification
npm run build:ts && echo "‚úÖ Plugin Built" && ls -la dist/

# Test suite status  
npm run test:integration:mcp && echo "‚úÖ MCP Integration Working"
```

## üéØ **RUN MODES & ENVIRONMENTS**

### **Development Mode (Primary)**
- **MCP Server**: `cd server && npx tsx src/server.ts`
- **Plugin Build**: `npm run build:ts` (watch mode: `npm run watch`)
- **Testing**: `npm run test:integration:mcp`
- **Health**: `npm run health`

### **Production Mode**
- **MCP Server**: `cd server && npm run build && npm start`
- **Plugin Bundle**: `./scripts/bundle-production.sh`
- **Testing**: `npm run validate:quick && npm run test:browser:smoke`
- **Deployment**: Load `manifest.json` in Figma Desktop

### **Testing Mode**
- **Standalone**: `npm run test:integration:mcp` (no Figma needed)
- **Live Figma**: Follow `tests/live/LIVE_FIGMA_INTEGRATION_TEST.md`
- **Browser**: `npm run test:browser:smoke`
- **Performance**: `npm run test:performance`

## üö® **CRITICAL DEBUGGING COMMANDS**

### **MCP Server Debugging**
```bash
# Server status
lsof -i :3000 || echo "MCP server not running"
curl -s http://localhost:3000/ | jq '.'

# Check MCP tools
curl -s http://localhost:3000/ | jq '.tools'

# Kill stuck processes
kill $(lsof -t -i:3000)
```

### **Plugin Debugging**
```bash
# Build status
npm run build:ts 2>&1 | grep -E "(error|Error)" || echo "‚úÖ Build OK"

# File verification
ls -la dist/ && echo "‚úÖ Dist files exist"
cat manifest.json | jq '.main' && echo "‚úÖ Manifest valid"
```

### **AI Integration Debugging** 
```bash
# Test AI services
cd server && echo $GEMINI_API_KEY | cut -c1-10 && echo "..." 
npm run test:integration:mcp | grep -E "(‚úÖ|‚ùå|Gemini)"
```

## üîÑ **WORKFLOW PATTERNS**

### **Daily Development Startup (MVC Architecture)**
```bash
cd /path/to/figma-ticket-generator
git pull origin main                 # Latest changes
npm run start:mvc &                  # Start MCP server (app/server/main.js)
npm run build:plugin                 # Build plugin for MVC Views
npm run test:integration:mcp         # Verify MCP integration working
npm run lint                         # Code quality check
```

### **Testing New Features (MVC Architecture)**
```bash
npm run build:plugin                 # Build MVC Views (plugin)
npm run test:integration:mcp         # Test MCP integration (Controllers)
npm run test:unit                    # Test core business logic (Models)
npm run test:browser:quick           # Test UI (Views)
npm run health                       # System health check
npm run lint                         # Code quality validation
```

### **Production Deployment (MVC Architecture)**
```bash
npm run validate:quick               # Full MVC validation
npm run build:plugin                 # Build production plugin
npm run test:browser:smoke          # Final UI validation
npm run start:mvc                    # Start production MCP server
# Load manifest.json in Figma Desktop
```

### **Emergency Debugging (MVC Architecture)**
```bash
# Reset everything
kill $(lsof -t -i:3000) 2>/dev/null  # Kill MCP server
npm run build:plugin                 # Rebuild plugin (MVC Views)
npm run start:mvc &                  # Restart MCP server (app/server/main.js)
sleep 3 && npm run test:integration:mcp    # Verify MCP integration
npm run health                       # System health check
```

### ÔøΩüìÅ **Mandatory Directory Structure**

```
docs/
‚îú‚îÄ‚îÄ MASTER_PROJECT_CONTEXT.md # üß† READ FIRST - Complete project context
‚îú‚îÄ‚îÄ project-phases/          # PHASE_*.md, *_COMPLETE.md
‚îú‚îÄ‚îÄ testing/                 # *TESTING*.md, TEST_RESULTS.md  
‚îú‚îÄ‚îÄ deployment/              # PRODUCTION*.md, LAUNCH*.md
‚îú‚îÄ‚îÄ troubleshooting/         # *FIXES*.md, ARCHITECTURE*.md
‚îú‚îÄ‚îÄ planning/                # *PLAN*.md, ROADMAP*.md
‚îú‚îÄ‚îÄ guides/                  # *INSTRUCTIONS*.md, *GUIDE*.md
‚îú‚îÄ‚îÄ api/                     # API documentation
‚îú‚îÄ‚îÄ architecture/            # System architecture docs
‚îî‚îÄ‚îÄ README.md               # Main documentation index
```

### ‚ùå **NEVER DO THIS**
- Creating .md files in project root: `./SOME_GUIDE.md` ‚ùå
- Scattered documentation files ‚ùå
- Multiple README files outside docs/ ‚ùå
- Creating .ts/.js files in project root without checking architecture ‚ùå
- Random file creation without understanding project structure ‚ùå
- Placing test files outside tests/ directory ‚ùå
- Creating scripts outside scripts/ directory ‚ùå
- Creating files without checking current working directory ‚ùå
- Making assumptions about file locations ‚ùå

### ‚úÖ **ALWAYS DO THIS**
1. **Before creating ANY file**: Check project architecture first
2. **Read context rules**: Follow `.ai-context-rules.md` EVERY time
3. **Check current location**: Use `pwd` or understand working directory context
4. **For documentation**: Use proper `docs/` subdirectory structure
5. **For code files**: Check `src/` structure and existing patterns
6. **For test files**: Use `tests/` directory with proper organization
7. **For scripts**: Use `scripts/` directory
8. **For UI tests**: Use `ui/test/` directory for UI-related test files
9. **Verify file placement**: Double-check target directory before creating
10. **Ask user**: If unsure about file placement or structure

### üéØ **MANDATORY PRE-FILE-CREATION CHECKLIST**
**BEFORE creating ANY file, I MUST:**

1. **Read `.ai-context-rules.md`** - These rules
2. **Check current working directory** - Use terminal context or understand location
3. **Check project structure** - Use `list_dir` to understand architecture
4. **Read `docs/MASTER_PROJECT_CONTEXT.md`** - Understand current context
5. **Determine correct location**:
   - Documentation (.md, README) ‚Üí `docs/[category]/` (api/, architecture/, deployment/, guides/, implementation/, planning/, project-phases/, roadmaps/, testing/, troubleshooting/)
   - Code ‚Üí `src/[module]/` 
   - Tests ‚Üí `tests/[type]/` OR `ui/test/` for UI tests
   - Scripts ‚Üí `scripts/`
   - Plugin code ‚Üí Check manifest.json and existing patterns
   - UI components ‚Üí `ui/` directory
6. **Verify target directory exists** - Use `list_dir` to confirm
7. **Ask user if unsure** - Never guess file placement
8. **Update context files** - If significant changes made

### üìù **DOCUMENTATION & README CREATION RULES**

#### **üö® CRITICAL: ALL .md FILES MUST GO IN `docs/` SUBDIRECTORIES**

**For Documentation Files (.md, guides, READMEs):**
1. **NEVER create .md files in project root** ‚ùå `./GUIDE.md`
2. **ALWAYS use proper `docs/` subdirectory** ‚úÖ `docs/guides/GUIDE.md`
3. **Check subdirectory purpose** before placement:
   - `docs/api/` - API documentation, references, endpoints
   - `docs/architecture/` - System design, MCP architecture, technical specs
   - `docs/deployment/` - Production deployment, launch guides
   - `docs/guides/` - User guides, setup instructions, how-tos
   - `docs/implementation/` - Implementation details, context, configurations
   - `docs/planning/` - Strategic plans, roadmaps, future planning
   - `docs/project-phases/` - Phase documentation, completion status
   - `docs/testing/` - Testing strategies, results, validation guides
   - `docs/troubleshooting/` - Bug fixes, common issues, debugging

#### **üìÅ FILE LOCATION DECISION TREE**
**Before creating ANY .md file, ask:**
- Is this about APIs? ‚Üí `docs/api/`
- Is this about system architecture? ‚Üí `docs/architecture/`
- Is this about deployment/production? ‚Üí `docs/deployment/`
- Is this a user guide or setup instructions? ‚Üí `docs/guides/`
- Is this about implementation details? ‚Üí `docs/implementation/`
- Is this about future planning? ‚Üí `docs/planning/`
- Is this about project phases? ‚Üí `docs/project-phases/`
- Is this about testing? ‚Üí `docs/testing/`
- Is this about troubleshooting? ‚Üí `docs/troubleshooting/`

### üéØ **Implementation Rule**
When user requests documentation or I need to create guides:
1. **STOP** - Read context rules first
2. **Check current location** - Understand where I am in the project
3. Ask: "What type of documentation is this?"
4. **Use decision tree** - Select correct `docs/` subdirectory
5. Create: File in proper organized location
6. Update: `docs/MASTER_PROJECT_CONTEXT.md` if significant
7. **NEVER**: Create documentation in project root

### üß™ **TEST FILE CREATION RULES**

#### **üéØ TEST FILE PLACEMENT DECISION**
**Before creating ANY test file:**
1. **Check file type and purpose:**
   - Unit tests ‚Üí `tests/unit/`
   - Integration tests ‚Üí `tests/integration/`
   - System tests ‚Üí `tests/system/`
   - Performance tests ‚Üí `tests/performance/`
   - UI/Browser tests ‚Üí `ui/test/` (HTML test files)
   - Live Figma tests ‚Üí `tests/live/`
   - Phase-specific tests ‚Üí `tests/phase[X]/`

2. **NEVER create test files in project root** ‚ùå
3. **Use existing test directory structure** ‚úÖ
4. **For UI test files (.html)** ‚Üí `ui/test/` directory
5. **For backend test files (.js, .ts)** ‚Üí `tests/[category]/`

### üö® **ARCHITECTURE RULE**
**CRITICAL:** This project uses MCP server architecture:
- Plugin UI ‚Üí HTTP requests ‚Üí MCP server (localhost:3000) ‚Üí AI/Figma APIs
- NEVER implement direct Figma API in plugin code
- ALWAYS route through MCP server HTTP endpoints
- MCP server has 4 tools: analyze_project, generate_tickets, check_compliance, generate_enhanced_ticket

## üìù **File Organization Completed**
- **17 files moved** from root to organized locations
- **Documentation Standards** created as reference
- **Main README updated** with proper links
- **Context rule established** for future consistency

## üö® **ENFORCEMENT MECHANISM**

### **If User Says: "You violated the context rules"**
**I MUST:**
1. **Acknowledge violation** immediately 
2. **Stop current work** and fix violations first
3. **Move misplaced files** to correct locations
4. **Clean up** any incorrect file placements
5. **Re-read context rules** before continuing
6. **Ask for confirmation** before proceeding

### **üîç MANDATORY FILE STRUCTURE ANALYSIS**

#### **BEFORE creating ANY file, I MUST run this analysis:**
```bash
# 1. Check current working directory
pwd

# 2. List current directory contents  
ls -la

# 3. Check project root structure
ls -la /Users/david/Documents/Figa-Jira-Automations-Tool/figma-ticket-generator/

# 4. Verify target directory exists
ls -la docs/          # For documentation
ls -la tests/         # For test files
ls -la ui/test/       # For UI test files
ls -la src/           # For source code
```

#### **Self-Check Questions (Before ANY file creation):**
- [ ] Did I read `.ai-context-rules.md`?
- [ ] Did I check my current working directory with `pwd`?
- [ ] Did I check the project structure with `list_dir`?
- [ ] Do I understand where this file should go?
- [ ] Is this documentation (.md)? ‚Üí Must go in `docs/[category]/`
- [ ] Is this a test file? ‚Üí `tests/[type]/` or `ui/test/` for HTML tests
- [ ] Is this code? ‚Üí Must follow `src/` structure  
- [ ] Is this a script? ‚Üí Must go in `scripts/`
- [ ] Is this UI-related? ‚Üí Must go in `ui/` structure
- [ ] Did I verify the target directory exists?
- [ ] Am I unsure? ‚Üí Ask the user first

#### **üö® LOCATION VERIFICATION CHECKLIST**
**For Documentation (.md files):**
- [ ] Checked `docs/` subdirectory structure
- [ ] Selected appropriate category (api/, guides/, testing/, etc.)
- [ ] Verified subdirectory exists
- [ ] **NEVER** placing in project root

**For Test Files:**
- [ ] Determined test type (unit, integration, UI, etc.)
- [ ] HTML test files ‚Üí `ui/test/`
- [ ] JavaScript/TypeScript tests ‚Üí `tests/[category]/`
- [ ] **NEVER** placing in project root

**For Code Files:**
- [ ] Checked existing `src/` structure
- [ ] Following established patterns
- [ ] Plugin code ‚Üí Check manifest.json references

### **üÜö KEY CONTEXT FILE DIFFERENCES**

#### **MASTER_PROJECT_CONTEXT.md vs .ai-context-rules.md:**
- **MASTER_PROJECT_CONTEXT.md** - Shows Phase 5 status (October 22) - PROJECT STATUS REFERENCE
- **.ai-context-rules.md** - Shows Phase 6 Complete status - AI ASSISTANT RULES (THIS FILE)
- **Discrepancy Alert** ‚ö†Ô∏è - Project status may need synchronization

#### **Usage Priority:**
1. **.ai-context-rules.md** (THIS FILE) - For AI assistant behavior and file creation rules
2. **MASTER_PROJECT_CONTEXT.md** - For overall project understanding and context

### **üö® ENHANCED ENFORCEMENT MECHANISM**

#### **If User Says: "You violated the context rules" OR "Files in wrong location"**
**I MUST:**
1. **STOP ALL WORK immediately** üõë
2. **Acknowledge violation** and apologize
3. **Analyze what went wrong:**
   - Did I check current working directory?
   - Did I verify project structure?
   - Did I follow the file placement rules?
4. **Fix violations first** before any other work:
   - Move misplaced files to correct locations
   - Clean up incorrect file placements
   - Verify all files are in proper directories
5. **Re-read context rules** completely
6. **Run structure analysis** before proceeding
7. **Ask for confirmation** before creating any new files

#### **Zero Tolerance Policy**
- **No exceptions** to documentation placement rules
- **No random file creation** without structure analysis
- **No assumptions** about project structure
- **No files in project root** without explicit user permission
- **When in doubt** ‚Üí Ask the user AND check structure

#### **Violation Prevention Protocol:**
```bash
# MANDATORY before creating ANY file:
pwd                                    # Check where I am
ls -la                                 # See current directory
list_dir /path/to/project/root        # Check project structure
# THEN decide file placement
```

---
**This rule applies to ALL future file creation! üö´ No exceptions.**
**Violation response: STOP ‚Üí Analyze ‚Üí Fix ‚Üí Verify ‚Üí Ask ‚Üí Proceed**