# 🤖 AI Assistant Context Rules

## 🚨 **CRITICAL DOCUMENTATION RULE**

**ALL documentation files (.md, README, guides, instructions) MUST be placed in the `docs/` directory.**

## 🧠 **MANDATORY SESSION STARTUP RULE**

### ⚡ **ALWAYS READ FIRST:**
1. **Read `docs/MASTER_PROJECT_CONTEXT.md`** - Complete project context and architecture
2. **Understand MCP server architecture** - Never implement direct Figma API
3. **Check current phase status** - Currently Phase 4 Production Ready
4. **Review documentation standards** - Follow organized structure

### **MANDATORY UPDATE RULE:**
**ALWAYS update `docs/MASTER_PROJECT_CONTEXT.md` after:**
- Major architectural changes
- Phase completions or milestones  
- Git pushes with significant changes
- Architecture decisions or clarifications
- AI service updates (API keys, service availability)

## ✅ **AI INTEGRATION DATA LAYER CONSOLE STATUS**

### **🎯 WORKING COMPONENTS (Verified October 16, 2025)**
- ✅ **MCP Server Pipeline**: Full data layer processing
- ✅ **Enhanced Data Validation**: Schema validation passing
- ✅ **AI Integration Console**: Real-time service status monitoring
- ✅ **Fallback System**: Graceful degradation when AI unavailable
- ✅ **Data Flow Visibility**: Complete pipeline transparency
- ✅ **Professional Output**: High-quality ticket generation

### **🔍 AI CONSOLE OUTPUT ANALYSIS**
```
🤖 Starting AI-enhanced ticket generation...
📋 Document type: jira
🔮 AI enabled: true  
🧠 AI Services Status: { gemini: false, geminiVision: false, ... }
⚠️ No AI services available, falling back to standard generation
🎫 Generating enhanced tickets for: 0 frames
🤝 Figma MCP integration: enabled
✅ AI ticket generation successful
```

### **🎯 DATA LAYER CONTEXT CONFIRMED**
The system successfully processes:
- **Enhanced Frame Data**: Component specs, dimensions, colors
- **Screenshot Data**: Base64 encoded images  
- **Tech Stack Context**: Framework and library information
- **Document Type**: Design system classification
- **Template Context**: File and page metadata
- **Accessibility Data**: WCAG compliance information
- **Typography & Spacing**: Complete design token extraction

## 🚀 **VITAL STARTUP SCRIPTS & RUN MODES**

### **🎯 CRITICAL MCP SERVER COMMANDS**
```bash
# Primary MCP Server Startup (ESSENTIAL)
cd server && npx tsx src/server.ts

# Alternative startup methods
cd server && npm run dev          # Development mode
cd server && npm run build && npm start  # Production mode

# Health Check (ALWAYS TEST FIRST)
curl -s http://localhost:3000/ --max-time 3
lsof -i :3000  # Check if port is in use
```

### **🔧 PLUGIN BUILD & TESTING COMMANDS**
```bash
# Build Plugin for Figma (ESSENTIAL)
npm run build:ts                      # TypeScript compilation
./scripts/build.sh                    # Development build
./scripts/bundle-production.sh        # Production bundle

# Quick Development Cycle
npm run build:ts && npm run test:integration:mcp && npm run health
```

### **🧪 TESTING COMMAND ARSENAL**

#### **MCP Integration Testing (PRIMARY)**
```bash
# Core MCP data layer testing (ESSENTIAL)
npm run test:integration:mcp          # Standalone MCP testing
npm run test:integration              # All integration tests

# MCP Server direct testing
curl -X POST http://localhost:3000/ \
  -H "Content-Type: application/json" \
  -d '{"method":"generate_ai_ticket","params":{"enhancedFrameData":[...]}}'
```

#### **System Health & Validation**
```bash
npm run health                        # System health (no servers needed)
npm run health:start                  # Health + auto-start servers
npm run validate:quick                # Complete validation (~3 min)
```

#### **Browser & UI Testing**
```bash
npm run test:browser:smoke           # Essential UI tests (~2 min)
npm run test:browser:quick           # Single UI test (~30s)  
npm run test:browser                 # Full cross-browser (~10 min)
npm run test:browser:headed          # Visual debugging
```

#### **Unit & Performance Testing**
```bash
npm run test:unit                    # Core logic tests (2s)
npm run test:performance             # Performance benchmarks
npm run test:all:quick              # Quick validation suite
```

### **📊 PROJECT STATUS COMMANDS**
```bash
# Check all systems
npm run health && curl -s http://localhost:3000/ && echo "✅ MCP Ready"

# Build verification
npm run build:ts && echo "✅ Plugin Built" && ls -la dist/

# Test suite status  
npm run test:integration:mcp && echo "✅ MCP Integration Working"
```

## 🎯 **RUN MODES & ENVIRONMENTS**

### **Development Mode (Primary)**
- **MCP Server**: `cd server && npx tsx src/server.ts`
- **Plugin Build**: `npm run build:ts` (watch mode: `npm run watch`)
- **Testing**: `npm run test:integration:mcp`
- **Health**: `npm run health`

### **Production Mode**
- **MCP Server**: `cd server && npm run build && npm start`
- **Plugin Bundle**: `./scripts/bundle-production.sh`
- **Testing**: `npm run validate:quick && npm run test:browser:smoke`
- **Deployment**: Load `manifest.json` in Figma Desktop

### **Testing Mode**
- **Standalone**: `npm run test:integration:mcp` (no Figma needed)
- **Live Figma**: Follow `tests/live/LIVE_FIGMA_INTEGRATION_TEST.md`
- **Browser**: `npm run test:browser:smoke`
- **Performance**: `npm run test:performance`

## 🚨 **CRITICAL DEBUGGING COMMANDS**

### **MCP Server Debugging**
```bash
# Server status
lsof -i :3000 || echo "MCP server not running"
curl -s http://localhost:3000/ | jq '.'

# Check MCP tools
curl -s http://localhost:3000/ | jq '.tools'

# Kill stuck processes
kill $(lsof -t -i:3000)
```

### **Plugin Debugging**
```bash
# Build status
npm run build:ts 2>&1 | grep -E "(error|Error)" || echo "✅ Build OK"

# File verification
ls -la dist/ && echo "✅ Dist files exist"
cat manifest.json | jq '.main' && echo "✅ Manifest valid"
```

### **AI Integration Debugging** 
```bash
# Test AI services
cd server && echo $GEMINI_API_KEY | cut -c1-10 && echo "..." 
npm run test:integration:mcp | grep -E "(✅|❌|Gemini)"
```

## 🔄 **WORKFLOW PATTERNS**

### **Daily Development Startup**
```bash
cd /path/to/figma-ticket-generator
git pull origin main                 # Latest changes
cd server && npx tsx src/server.ts &  # Start MCP
npm run build:ts                     # Build plugin
npm run test:integration:mcp         # Verify working
```

### **Testing New Features**
```bash
npm run build:ts                     # Build changes
npm run test:integration:mcp         # Test MCP integration
npm run test:browser:quick           # Test UI
npm run health                       # System check
```

### **Production Deployment**
```bash
npm run validate:quick               # Full validation
./scripts/bundle-production.sh      # Create production bundle
npm run test:browser:smoke          # Final UI test
# Load manifest.json in Figma Desktop
```

### **Emergency Debugging**
```bash
# Reset everything
kill $(lsof -t -i:3000) 2>/dev/null  # Kill MCP server
npm run build:ts                     # Rebuild plugin
cd server && npx tsx src/server.ts &  # Restart MCP
sleep 3 && npm run test:integration:mcp    # Verify
```

### �📁 **Mandatory Directory Structure**

```
docs/
├── MASTER_PROJECT_CONTEXT.md # 🧠 READ FIRST - Complete project context
├── project-phases/          # PHASE_*.md, *_COMPLETE.md
├── testing/                 # *TESTING*.md, TEST_RESULTS.md  
├── deployment/              # PRODUCTION*.md, LAUNCH*.md
├── troubleshooting/         # *FIXES*.md, ARCHITECTURE*.md
├── planning/                # *PLAN*.md, ROADMAP*.md
├── guides/                  # *INSTRUCTIONS*.md, *GUIDE*.md
├── api/                     # API documentation
├── architecture/            # System architecture docs
└── README.md               # Main documentation index
```

### ❌ **NEVER DO THIS**
- Creating .md files in project root: `./SOME_GUIDE.md` ❌
- Scattered documentation files ❌
- Multiple README files outside docs/ ❌
- Creating .ts/.js files in project root without checking architecture ❌
- Random file creation without understanding project structure ❌
- Placing test files outside tests/ directory ❌
- Creating scripts outside scripts/ directory ❌

### ✅ **ALWAYS DO THIS**
1. **Before creating ANY file**: Check project architecture first
2. **Read context rules**: Follow `.ai-context-rules.md` EVERY time
3. **For documentation**: Use proper `docs/` subdirectory structure
4. **For code files**: Check `src/` structure and existing patterns
5. **For test files**: Use `tests/` directory with proper organization
6. **For scripts**: Use `scripts/` directory
7. **Ask user**: If unsure about file placement or structure

### 🎯 **MANDATORY PRE-FILE-CREATION CHECKLIST**
**BEFORE creating ANY file, I MUST:**

1. **Read `.ai-context-rules.md`** - These rules
2. **Check project structure** - Use `list_dir` to understand architecture
3. **Read `docs/MASTER_PROJECT_CONTEXT.md`** - Understand current context
4. **Determine correct location**:
   - Documentation → `docs/[category]/`
   - Code → `src/[module]/` 
   - Tests → `tests/[type]/`
   - Scripts → `scripts/`
   - Plugin code → Check manifest.json and existing patterns
5. **Ask user if unsure** - Never guess file placement
6. **Update context files** - If significant changes made

### 🎯 **Implementation Rule**
When user requests documentation or I need to create guides:
1. **STOP** - Read context rules first
2. Ask: "What type of documentation is this?"
3. Use: Correct `docs/` subdirectory
4. Create: File in proper organized location
5. Update: `docs/MASTER_PROJECT_CONTEXT.md` if significant
6. **NEVER**: Create documentation in project root

### 🚨 **ARCHITECTURE RULE**
**CRITICAL:** This project uses MCP server architecture:
- Plugin UI → HTTP requests → MCP server (localhost:3000) → AI/Figma APIs
- NEVER implement direct Figma API in plugin code
- ALWAYS route through MCP server HTTP endpoints
- MCP server has 4 tools: analyze_project, generate_tickets, check_compliance, generate_enhanced_ticket

## 📝 **File Organization Completed**
- **17 files moved** from root to organized locations
- **Documentation Standards** created as reference
- **Main README updated** with proper links
- **Context rule established** for future consistency

## 🚨 **ENFORCEMENT MECHANISM**

### **If User Says: "You violated the context rules"**
**I MUST:**
1. **Acknowledge violation** immediately 
2. **Stop current work** and fix violations first
3. **Move misplaced files** to correct locations
4. **Clean up** any incorrect file placements
5. **Re-read context rules** before continuing
6. **Ask for confirmation** before proceeding

### **Self-Check Questions (Before ANY file creation):**
- [ ] Did I read `.ai-context-rules.md`?
- [ ] Did I check the project structure with `list_dir`?
- [ ] Do I understand where this file should go?
- [ ] Is this documentation? → Must go in `docs/[category]/`
- [ ] Is this code? → Must follow `src/` structure  
- [ ] Is this a test? → Must go in `tests/`
- [ ] Am I unsure? → Ask the user first

### **Zero Tolerance Policy**
- **No exceptions** to documentation placement rules
- **No random file creation** without context checking
- **No assumptions** about project structure
- **When in doubt** → Ask the user

---
**This rule applies to ALL future file creation! 🚫 No exceptions.**
**Violation response: Stop, fix, ask, then proceed.**